
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="assets/images/olive-leaf-md copy-version-agnostic.ico">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-6.2.3">
    
    
      
        <title>JOlive Primer - OLIVE</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.3b61ea93.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.39b8e14a.min.css">
        
          
          
          <meta name="theme-color" content="#4051b5">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="assets/css/swagger-ui.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="indigo" data-md-color-accent="brown">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#integrating-with-the-olive-java-api-jolive" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="index.html" title="OLIVE" class="md-header-nav__button md-logo" aria-label="OLIVE">
      
  <img src="assets/images/olive-leaf-md copy-version-agnostic.ico" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            OLIVE
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              JOlive Primer
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="OLIVE" class="md-nav__button md-logo" aria-label="OLIVE">
      
  <img src="assets/images/olive-leaf-md copy-version-agnostic.ico" alt="logo">

    </a>
    OLIVE
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      



  <li class="md-nav__item">
    <a href="index.html" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    
    <label class="md-nav__link" for="nav-2">
      Administration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Administration" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2-1" type="checkbox" id="nav-2-1" >
    
    <label class="md-nav__link" for="nav-2-1">
      Installation/Setup
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Installation/Setup" data-md-level="2">
      <label class="md-nav__title" for="nav-2-1">
        <span class="md-nav__icon md-icon"></span>
        Installation/Setup
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="martini.html" class="md-nav__link">
      OLIVE Martini Docker Setup
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="install.html" class="md-nav__link">
      OLIVE CentOS/RedHat 7 Native Setup (deprecated)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="gpu-config.html" class="md-nav__link">
      GPU Plugin Configuration
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="server.html" class="md-nav__link">
      Server Guide
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="hardware.html" class="md-nav__link">
      OLIVE System Requirements
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    
    <label class="md-nav__link" for="nav-3">
      Usage
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Usage" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Usage
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-1" type="checkbox" id="nav-3-1" >
    
    <label class="md-nav__link" for="nav-3-1">
      User Interfaces
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User Interfaces" data-md-level="2">
      <label class="md-nav__title" for="nav-3-1">
        <span class="md-nav__icon md-icon"></span>
        User Interfaces
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="nightingale.html" class="md-nav__link">
      Nightingale GUI
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="raven.html" class="md-nav__link">
      Raven Batch Web GUI
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="clients.html" class="md-nav__link">
      Java and Python CLI Client Utilities
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="cli.html" class="md-nav__link">
      Command Line Tools (Deprecated)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="redaction.html" class="md-nav__link">
      Speaker Redaction
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="audioFormats.html" class="md-nav__link">
      Supported Audio Formats
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      Integration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Integration" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Integration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-1" type="checkbox" id="nav-4-1" >
    
    <label class="md-nav__link" for="nav-4-1">
      Enterprise API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Enterprise API" data-md-level="2">
      <label class="md-nav__title" for="nav-4-1">
        <span class="md-nav__icon md-icon"></span>
        Enterprise API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="apiInfo.html" class="md-nav__link">
      Enterprise API Primer
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="apiBuildReferenceImp.html" class="md-nav__link">
      Building an API Reference Implementation
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="apiMessage.html" class="md-nav__link">
      Enterprise API Message Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="restApi.html" class="md-nav__link">
      OLIVE REST API
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="traits.html" class="md-nav__link">
      OLIVE Plugin Traits
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="workflows.html" class="md-nav__link">
      Workflows
    </a>
  </li>

        
          
          
          


  


  
  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5" checked>
    
    <label class="md-nav__link" for="nav-4-5">
      Java API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Java API" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        <span class="md-nav__icon md-icon"></span>
        Java API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        JOlive Primer
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="apiCode.html" class="md-nav__link md-nav__link--active">
      JOlive Primer
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#distribution" class="md-nav__link">
    Distribution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration" class="md-nav__link">
    Integration
  </a>
  
    <nav class="md-nav" aria-label="Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    Quickstart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#establish-server-connection" class="md-nav__link">
    Establish Server Connection
  </a>
  
    <nav class="md-nav" aria-label="Establish Server Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tls-encrypted-connections" class="md-nav__link">
    TLS Encrypted Connections
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-available-plugins" class="md-nav__link">
    Request Available Plugins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audio-submission-guidelines" class="md-nav__link">
    Audio Submission Guidelines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronous-vs-asynchronous-message-submission" class="md-nav__link">
    Synchronous vs. Asynchronous Message Submission
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#olive-java-api-code-samples" class="md-nav__link">
    OLIVE Java API Code Samples
  </a>
  
    <nav class="md-nav" aria-label="OLIVE Java API Code Samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frame-score-request" class="md-nav__link">
    Frame Score Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-score-request" class="md-nav__link">
    Global Score Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#region-score-request" class="md-nav__link">
    Region Score Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enrollment-request" class="md-nav__link">
    Enrollment Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-specific-code-examples" class="md-nav__link">
    Plugin Specific Code Examples
  </a>
  
    <nav class="md-nav" aria-label="Plugin Specific Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sad-scoring-request" class="md-nav__link">
    SAD Scoring Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sid-enrollment-and-scoring-request" class="md-nav__link">
    SID Enrollment and Scoring Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lid-enrollment-and-scoring-request" class="md-nav__link">
    LID Enrollment and Scoring Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asr-scoring-request" class="md-nav__link">
    ASR Scoring Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmt-request" class="md-nav__link">
    TMT Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sad-adaptation-request" class="md-nav__link">
    SAD Adaptation Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-6" type="checkbox" id="nav-4-6" >
    
    <label class="md-nav__link" for="nav-4-6">
      Python API
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Python API" data-md-level="2">
      <label class="md-nav__title" for="nav-4-6">
        <span class="md-nav__icon md-icon"></span>
        Python API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="olivepyPrimer.html" class="md-nav__link">
      olivepy Primer
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="olivepy-api.html" class="md-nav__link">
      olivepy API Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    
    <label class="md-nav__link" for="nav-5">
      Plugins
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Plugins" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Plugins
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins.html" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="releasePlugins.html" class="md-nav__link">
      Release Plugins
    </a>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3" >
    
    <label class="md-nav__link" for="nav-5-3">
      Speech
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Speech" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        <span class="md-nav__icon md-icon"></span>
        Speech
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/sad-dnn-v8.html" class="md-nav__link">
      Speech Activity Detection (SAD)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/vtd-dnn-v7.html" class="md-nav__link">
      Voice Type Discrimination (VTD)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/dfa-global-v1.html" class="md-nav__link">
      Deep Fake Audio Detection (DFA)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/dfa-speakerSpecific-phonetic-v1.html" class="md-nav__link">
      Deep Fake Audio Detection Speaker Specific Phonetic (DFA)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-4" type="checkbox" id="nav-5-4" >
    
    <label class="md-nav__link" for="nav-5-4">
      Speaker
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Speaker" data-md-level="2">
      <label class="md-nav__title" for="nav-5-4">
        <span class="md-nav__icon md-icon"></span>
        Speaker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/sid-dplda-v3.html" class="md-nav__link">
      Speaker Identification (SID)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/sdd-diarizeEmbedSmolive-v1.html" class="md-nav__link">
      Speaker Detection (SDD) Low Resource
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/shl-sbcEmbed-v1.html" class="md-nav__link">
      Speaker Highlighting (SHL)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-5" type="checkbox" id="nav-5-5" >
    
    <label class="md-nav__link" for="nav-5-5">
      Language
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Language" data-md-level="2">
      <label class="md-nav__title" for="nav-5-5">
        <span class="md-nav__icon md-icon"></span>
        Language
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/lid-embedplda-v4.html" class="md-nav__link">
      Language Identification (LID) GPU
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/lid-hdplda-v2.html" class="md-nav__link">
      Language Identification (LID)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/ldd-embedpldaSmolive-v1.html" class="md-nav__link">
      Lanugage Detection (LDD) Low Resource
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-6" type="checkbox" id="nav-5-6" >
    
    <label class="md-nav__link" for="nav-5-6">
      Gender
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Gender" data-md-level="2">
      <label class="md-nav__title" for="nav-5-6">
        <span class="md-nav__icon md-icon"></span>
        Gender
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/gid-gb-v2.html" class="md-nav__link">
      Gender Identification (GID)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/gdd-embedplda-v1.html" class="md-nav__link">
      Gender Detection (GDD)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-7" type="checkbox" id="nav-5-7" >
    
    <label class="md-nav__link" for="nav-5-7">
      Keyword
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Keyword" data-md-level="2">
      <label class="md-nav__title" for="nav-5-7">
        <span class="md-nav__icon md-icon"></span>
        Keyword
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/qbe-ftdnnSmolive-v1.html" class="md-nav__link">
      Query By Example (QBE)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-8" type="checkbox" id="nav-5-8" >
    
    <label class="md-nav__link" for="nav-5-8">
      Transcription
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Transcription" data-md-level="2">
      <label class="md-nav__title" for="nav-5-8">
        <span class="md-nav__icon md-icon"></span>
        Transcription
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/asr-whisper-v1.html" class="md-nav__link">
      Automatic Speech Recognition (ASR) whisper/GPU
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/asr-end2end-v1.html" class="md-nav__link">
      Automatic Speech Recognition (ASR) end2end/GPU
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/asr-dynapy-v4.html" class="md-nav__link">
      Automatic Speech Recognition (ASR)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-9" type="checkbox" id="nav-5-9" >
    
    <label class="md-nav__link" for="nav-5-9">
      Translation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Translation" data-md-level="2">
      <label class="md-nav__title" for="nav-5-9">
        <span class="md-nav__icon md-icon"></span>
        Translation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/tmt-ctranslate-v1.html" class="md-nav__link">
      Text Machine Translation (TMT)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-10" type="checkbox" id="nav-5-10" >
    
    <label class="md-nav__link" for="nav-5-10">
      Topic
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Topic" data-md-level="2">
      <label class="md-nav__title" for="nav-5-10">
        <span class="md-nav__icon md-icon"></span>
        Topic
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/tpd-dynapy-v5.html" class="md-nav__link">
      Topic Detection (TPD) ASR-based
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/tpd-fusion-v1.html" class="md-nav__link">
      Topic Detection (TPD) ASR/Acoustic Fusion
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-11" type="checkbox" id="nav-5-11" >
    
    <label class="md-nav__link" for="nav-5-11">
      Manipulation
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Manipulation" data-md-level="2">
      <label class="md-nav__title" for="nav-5-11">
        <span class="md-nav__icon md-icon"></span>
        Manipulation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/red-transform-v1.html" class="md-nav__link">
      Redaction (RED) Transformation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          



  
  <li class="md-nav__item md-nav__item--nested">
    
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-12" type="checkbox" id="nav-5-12" >
    
    <label class="md-nav__link" for="nav-5-12">
      Imagery
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Imagery" data-md-level="2">
      <label class="md-nav__title" for="nav-5-12">
        <span class="md-nav__icon md-icon"></span>
        Imagery
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/fdi-pyEmbed-v1.html" class="md-nav__link">
      Face Detection Image (FDI)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/fdv-pyEmbed-v1.html" class="md-nav__link">
      Face Detection Video (FDV)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/fri-pyEmbed-v1.html" class="md-nav__link">
      Face Recognition Image (FRI)
    </a>
  </li>

        
          
          
          



  <li class="md-nav__item">
    <a href="plugins/frv-pyEmbed-v1.html" class="md-nav__link">
      Face Recognition Video (FRV)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="glossary.html" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      



  <li class="md-nav__item">
    <a href="contact.html" class="md-nav__link">
      Contact
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#distribution" class="md-nav__link">
    Distribution
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dependencies" class="md-nav__link">
    Dependencies
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#integration" class="md-nav__link">
    Integration
  </a>
  
    <nav class="md-nav" aria-label="Integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#quickstart" class="md-nav__link">
    Quickstart
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#establish-server-connection" class="md-nav__link">
    Establish Server Connection
  </a>
  
    <nav class="md-nav" aria-label="Establish Server Connection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tls-encrypted-connections" class="md-nav__link">
    TLS Encrypted Connections
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#request-available-plugins" class="md-nav__link">
    Request Available Plugins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audio-submission-guidelines" class="md-nav__link">
    Audio Submission Guidelines
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronous-vs-asynchronous-message-submission" class="md-nav__link">
    Synchronous vs. Asynchronous Message Submission
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#olive-java-api-code-samples" class="md-nav__link">
    OLIVE Java API Code Samples
  </a>
  
    <nav class="md-nav" aria-label="OLIVE Java API Code Samples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frame-score-request" class="md-nav__link">
    Frame Score Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-score-request" class="md-nav__link">
    Global Score Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#region-score-request" class="md-nav__link">
    Region Score Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#enrollment-request" class="md-nav__link">
    Enrollment Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#plugin-specific-code-examples" class="md-nav__link">
    Plugin Specific Code Examples
  </a>
  
    <nav class="md-nav" aria-label="Plugin Specific Code Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sad-scoring-request" class="md-nav__link">
    SAD Scoring Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sid-enrollment-and-scoring-request" class="md-nav__link">
    SID Enrollment and Scoring Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lid-enrollment-and-scoring-request" class="md-nav__link">
    LID Enrollment and Scoring Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asr-scoring-request" class="md-nav__link">
    ASR Scoring Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tmt-request" class="md-nav__link">
    TMT Request
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sad-adaptation-request" class="md-nav__link">
    SAD Adaptation Request
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="integrating-with-the-olive-java-api-jolive">Integrating with the OLIVE Java API (JOlive)</h1>
<p>While the OLIVE Server allows direct client integration via Protobuf messages—from a variety of languages such as Java, Python, C++ and C# and operating systems such as Windows, Linux, and MacOS—a Java native API is also provided as a convenience.  This page includes guidance for integrating a client application using the OLIVE Java API.</p>
<p>The sections below cover establishing a connection to an OLIVE Server, requesting available plugins, various ways to build and submit scoring and enrollment requests, and model adaptation. All instructions and code examples presented in this section are for the OLIVE Java API.</p>
<div class="admonition info">
<p class="admonition-title">Fundamentally, all OLIVE API implementations are based on exchanging Protobuf messages between the client and OLIVE Server. These messages are defined in the <a href="apiMessage.html">API Message Reference</a> Documentation. It's recommended that new integrators review the <a href="apiInfo.html">Enterprise API Primer</a> for an overview of key concepts that also apply to the OLIVE Java API.</p>
</div>
<h2 id="distribution"><strong>Distribution</strong></h2>
<p>The OLIVE Java API is distributed as a JAR file. It is located in the OLIVE delivery at the path <code>api/java/repo/sri/speech/olive/api/olive-api/&lt;version&gt;/olive-api-&lt;version&gt;.jar</code>.</p>
<h2 id="dependencies"><strong>Dependencies</strong></h2>
<p>The OLIVE Java API dependencies include:</p>
<ul>
<li><code>com.google.protobuf:protobuf-java:3.8.0</code></li>
<li><code>com.google.protobuf:protobuf-java-util:3.8.0</code></li>
<li><code>com.googlecode.json-simple:json-simple:1.1.1</code></li>
<li><code>org.json:json:20220320</code></li>
<li><code>org.zeromq:jeromq:0.5.2</code></li>
<li><code>org.slf4j:slf4j-api:1.7.30</code></li>
<li><code>ch.qos.logback:logback-core:1.2.3</code></li>
<li><code>ch.qos.logback:logback-classic:1.2.3</code></li>
<li><code>commons-lang:commons-lang:2.6</code></li>
<li><code>commons-io:commons-io:2.4</code></li>
<li><code>commons-cli:commons-cli:1.4</code></li>
</ul>
<p>All dependencies are bundled with the OLIVE delivery in the directory <code>api/java/repo</code>.  </p>
<details>
<summary>Using api/java/repo as a maven remote repository for offline support</summary>
Using <code>api/java/repo</code> as maven remote repository lets integrators set up their project offline without pulling dependencies from Maven Central. <br/> <br/>

Add the following to the project's <code>pom.xml</code> (replacing the stub <code>local_path_to_jolive</code> with the actual path):
<div class="highlight"><pre><span></span><code><span class="nt">&lt;repositories&gt;</span>
     <span class="nt">&lt;repository&gt;</span>
        <span class="nt">&lt;id&gt;</span>repo_id<span class="nt">&lt;/id&gt;</span>
        <span class="nt">&lt;url&gt;</span>file:///local_path_to_jolive/repo<span class="nt">&lt;/url&gt;</span>
    <span class="nt">&lt;/repository&gt;</span>
<span class="nt">&lt;/repositories&gt;</span>
</code></pre></div>

Next, add the OLIVE Java API and it's dependencies to the project's <code>pom.xml</code>.
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependencies&gt;</span>
    ...
    <span class="nt">&lt;dependency&gt;</span>
      <span class="nt">&lt;groupId&gt;</span>com.sri.speech.olive.api<span class="nt">&lt;/groupId&gt;</span>
      <span class="nt">&lt;artifactId&gt;</span>olive-api<span class="nt">&lt;/artifactId&gt;</span>
      <span class="nt">&lt;version&gt;</span>api version provided<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    ...
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div>

For example, 
<code>com.google.protobuf:protobuf-java:3.8.0</code> should be added as:
<div class="highlight"><pre><span></span><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>com.google.protobuf<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>protobuf-java<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>3.8.0<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>

You should now be able to develop with the OLIVE Java API within your maven project.
</details>

<h2 id="integration"><strong>Integration</strong></h2>
<h3 id="quickstart"><strong>Quickstart</strong></h3>
<p>Here's a complete example for those in a hurry:</p>
<!-- This example is taken from api/reference/java/.../Quickstart.java -->
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Server</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.ClientUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.ClientUtils.AudioTransferType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.Pair</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Quickstart</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">Quickstart</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SERVERNAME</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">5588</span><span class="p">;</span>

    <span class="c1">// Create a callback to handle LID results from the server</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScore</span> <span class="n">topScore</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScore</span> <span class="n">gs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreList</span><span class="p">())</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">topScore</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">topScore</span> <span class="o">=</span> <span class="n">gs</span><span class="p">;</span>
                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">gs</span><span class="p">.</span><span class="na">getScore</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">topScore</span><span class="p">.</span><span class="na">getScore</span><span class="p">())</span> <span class="p">{</span>
                            <span class="n">topScore</span> <span class="o">=</span> <span class="n">gs</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Top scoring: {} = {}&quot;</span><span class="p">,</span> <span class="n">topScore</span><span class="p">.</span><span class="na">getClassId</span><span class="p">(),</span> <span class="n">topScore</span><span class="p">.</span><span class="na">getScore</span><span class="p">());</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Global scorer error: {%s}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
            <span class="p">}</span>

            <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">// audio file name is passed as an argument</span>
        <span class="n">String</span> <span class="n">audioFileName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>

        <span class="c1">// Setup the connection to the OLIVE server</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
        <span class="n">server</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">TIMEOUT</span><span class="p">);</span> 

        <span class="c1">// wait for the connection</span>
        <span class="kt">long</span> <span class="n">start_t</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_t</span> <span class="o">&lt;</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">synchronized</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">wait</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Keep waiting</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// exit if cannot connect</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to connect to the OLIVE server: {}&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// find a Language ID (LID) plugin</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;&gt;</span> <span class="n">pluginList</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestPlugins</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

        <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="p">:</span> <span class="n">pluginList</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s">&quot;LID&quot;</span><span class="p">.</span><span class="na">equalsIgnoreCase</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="na">getFirst</span><span class="p">().</span><span class="na">getTask</span><span class="p">()))</span> <span class="p">{</span>
                <span class="n">pd</span> <span class="o">=</span> <span class="n">pair</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// run Language ID (LID) on serialized audio file</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">pd</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>                    
            <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestGlobalScore</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">GLOBAL_SCORER</span><span class="p">,</span> <span class="n">audioFileName</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Could not retrieve a LID plugin!&quot;</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<p>The code above accepts a filepath command line argument, connects to an OLIVE Server, programmatically locates a Language Identification (LID) plugin, submits a serialized audio file for LID analysis, and finally prints out the top scoring language.</p>
<h3 id="establish-server-connection"><strong>Establish Server Connection</strong></h3>
<p>Before making any request, a client must establish a connection with the server.  By default, the OLIVE server listens on ports <code>5588</code> (request port) and <code>5589</code> (status port) for client connection and status requests. These ports are configurable, but if the server has not been instructed to change its listening ports, the code below should establish a connection.</p>
<p>A connection to the server can be established with a call to <code>com.sri.speech.olive.api.Server#connect()</code>, as shown below:</p>
<!-- This example is taken from api/reference/java/.../EstablishServerConnection.java -->
<div class="highlight"><pre><span></span><code><span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
<span class="n">server</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span>
    <span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="c1">//client-id</span>
    <span class="s">&quot;localhost&quot;</span><span class="p">,</span>  <span class="c1">//address of server</span>
    <span class="mi">5588</span><span class="p">,</span>  <span class="c1">//request-port</span>
    <span class="mi">5589</span><span class="p">,</span>  <span class="c1">//status-port</span>
    <span class="mi">10000</span>  <span class="c1">//timeout for failed connection request</span>
<span class="p">);</span>
</code></pre></div>
<p>The request port (5588 by default) is used for request and response messages (Protobuf messages).  Each request message sent to this port is guaranteed a response from the server. Messages in the <a href="apiMessage.html">API Message Reference</a> are often suffixed with 'Request' and 'Result' to denote whether it's a request or result message.  There is no need to poll the server for information on a submitted request, as the result/response for the a request is returned to the client as soon as it is available.</p>
<p>The status port (5589 by default) is used by the Server to publish health and status messages (Heartbeat) to client(s). Clients can not send requests on this port.</p>
<h4 id="tls-encrypted-connections"><strong>TLS Encrypted Connections</strong></h4>
<p>As of 5.6.0, the OLIVE Java API supports TLS encrypted communication with the OLIVE Server.</p>
<div class="admonition info">
<p class="admonition-title">Encrypted connections require the OLIVE Server to be configured and started with TLS.  For example, OLIVE Martini must be started with the flag  <code>--tls_server_only</code> or <code>--tls_server_and_client</code>.</p>
</div>
<p>By default, OLIVE listens on port <code>5588</code> for encrypted connections.</p>
<p>To set up an encrypted connection using the OLIVE Java API, connect using the <code>com.sri.speech.olive.api.Server#secureConnect()</code> method and provide the required PKCS12 (<code>*.p12</code>) certificate arguments:</p>
<!-- Another example of this can be found in api/reference/java/.../QuickstartSecure.java -->
<div class="highlight"><pre><span></span><code><span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
<span class="n">server</span><span class="p">.</span><span class="na">secureConnect</span><span class="p">(</span>
    <span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="c1">//client-id</span>
    <span class="s">&quot;localhost&quot;</span><span class="p">,</span>  <span class="c1">//address of server</span>
    <span class="mi">5588</span><span class="p">,</span>  <span class="c1">//secure port</span>
    <span class="s">&quot;path/to/certificate.p12&quot;</span><span class="p">,</span> <span class="c1">//certificate path</span>
    <span class="s">&quot;certificatePassword&quot;</span><span class="p">,</span> <span class="c1">//certificate password</span>
    <span class="s">&quot;path/to/cert/authority.p12&quot;</span> <span class="c1">//certificate authority path</span>
    <span class="s">&quot;authorityPassword&quot;</span><span class="p">,</span> <span class="c1">//certificate authority password </span>
    <span class="mi">10000</span>  <span class="c1">//timeout for failed connection request</span>
<span class="p">);</span>
</code></pre></div>
<p>Connecting to the OLIVE Server using TLS encryption takes slightly longer than a standard non-encrypted connection; however, after the initial connection is made, all subsequent requests will run over TLS with no time penalty.</p>
<h3 id="request-available-plugins"><strong>Request Available Plugins</strong></h3>
<p>In order to submit most server requests, the client must specify the plugin and domain pair to use for the request (i.e. <code>Pair&lt;Olive.Plugin, Olive.Domain&gt;</code>).  The function <code>requestPlugins()</code> provided by the <code>ClientUtils</code> class can be used to get all the plugin/domain pairs available:</p>
<!-- This example is taken from  api/reference/java/.../RequestAvailablePlugins.java-->
<div class="highlight"><pre><span></span><code><span class="c1">// ask the server for a list of currently available plugins</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;&gt;</span> <span class="n">pluginList</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestPlugins</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
</code></pre></div>
<p>The pairs can be iterated through looking for specific criteria of interest.</p>
<!-- This example is taken from  api/reference/java/.../RequestAvailablePlugins.java-->
<div class="highlight"><pre><span></span><code><span class="c1">// iterate through and find a plugin and domain to use for SAD</span>
<span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pair</span> <span class="p">:</span> <span class="n">pluginList</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="s">&quot;SAD&quot;</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="na">getFirst</span><span class="p">().</span><span class="na">getTask</span><span class="p">()))</span> <span class="p">{</span>
        <span class="n">pd</span> <span class="o">=</span> <span class="n">pair</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="n">pd</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;{}/{} supports SAD!&quot;</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="na">getFirst</span><span class="p">().</span><span class="na">getId</span><span class="p">(),</span> <span class="n">pd</span><span class="p">.</span><span class="na">getSecond</span><span class="p">().</span><span class="na">getLabel</span><span class="p">());</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;No SAD plugin found!&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Alternatively, if the client already knows the desired plugin ID and domain name, the pair reference can be obtained using the <code>findPluginDomain()</code> provided by the <code>ClientUtils</code> class. </p>
<!-- This example is taken from  api/reference/java/.../RequestAvailablePlugins.java-->
<div class="highlight"><pre><span></span><code><span class="n">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="s">&quot;sad-dnn-v8.0.0&quot;</span><span class="p">;</span>
<span class="n">String</span> <span class="n">domainName</span> <span class="o">=</span> <span class="s">&quot;multi-v1&quot;</span><span class="p">;</span>

<span class="c1">// Look up a specific plugin by ID and domain</span>
<span class="n">pd</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">findPluginDomain</span><span class="p">(</span><span class="n">pluginName</span><span class="p">,</span> <span class="n">domainName</span><span class="p">,</span> <span class="n">pluginList</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="n">pd</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;{}/{} was found!&quot;</span><span class="p">,</span> <span class="n">pd</span><span class="p">.</span><span class="na">getFirst</span><span class="p">().</span><span class="na">getId</span><span class="p">(),</span> <span class="n">pd</span><span class="p">.</span><span class="na">getSecond</span><span class="p">().</span><span class="na">getLabel</span><span class="p">());</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;{}/{} was NOT found!&quot;</span><span class="p">,</span> <span class="n">pluginName</span><span class="p">,</span> <span class="n">domainName</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="audio-submission-guidelines"><strong>Audio Submission Guidelines</strong></h3>
<p>One of the core client activities is submitting Audio with a request. In the OLIVE Java API, three ways are provided for a client to send audio data to the OLIVE server:</p>
<ul>
<li>file path</li>
<li>buffer of raw audio sample data</li>
<li>serialized file buffer object</li>
</ul>
<p>The enum <code>ClientUtils.AudioTransferType</code> is used to specify which of the three transfer mechanisms to use. In almost every case, the OLIVE Java API handles packaging up audio appropriately based on the passed in <code>AudioTransferType</code> so the client only needs to understand a few basic related to the transfer type, and they are explained below.</p>
<p>When the client and the OLIVE server share the same file system, the easiest way for the client to send audio data to the server is by specifying the audio's file path on disk.  The OLIVE Java API provides the utility below to package audio files which are accessible to the server locally:</p>
<div class="highlight"><pre><span></span><code><span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_AS_PATH</span>
</code></pre></div>
<p>When the client and the server don't share the same file system, as in the case of a client making a remote connection to the OLIVE server, it is necessary to send the client's local audio files as a file buffer.  To help package the client's audio data in a raw buffer, the OLIVE Java API provides the utility below:</p>
<div class="highlight"><pre><span></span><code><span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SAMPLES_BUFFER</span>
</code></pre></div>
<p>When the client wants to ensure that all audio header information is provided intact to the server, the OLIVE Java API provides the utility below:</p>
<div class="highlight"><pre><span></span><code><span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">Note on 'serialized buffer' usage.<p>This transfer mechanism passes the original file to the server in its entirety in one contiguous buffer, leaving the audio file header intact. This allows the server to properly decode and process the audio once its received, since it can directly access the bit depth, encoding type, sample rate and other necessary information from the header itself. The tradeoff with serialized files is that there may be additional overhead needed to process the audio into a consumable form.  If the client and server reside on the same hardware and file system, it is advisable to simply pass filepaths when possible. This saves the memory overhead burden of both the client and server loading audio into memory.  If using common audio types, like 16-bit PCM .wav files, it may also be possible to simply pass a non-serialized file buffer.</p>
</p>
</div>
<h3 id="synchronous-vs-asynchronous-message-submission"><strong>Synchronous vs. Asynchronous Message Submission</strong></h3>
<p>The OLIVE Java API allows the client to choose between processing a task request synchronously or asynchronously.  Processing a task request synchronously means the client will block and wait for the task result to return before proceeding to other task requests.  On the other hand, asynchronous processing means the client will not wait for the result to come back before moving on, allowing several jobs to be submitted in parallel.  The examples below generally show submitting requests asynchronously.  </p>
<p>The argument <code>async</code> is used in many <code>ClientUtils</code> functions (<code>requestFrameScore()</code>, <code>requestGlobalScore()</code>, <code>requestRegionScores()</code>, <code>requestEnrollClass()</code>, etc.), and can be used to choose whether the client intends to wait for the task result to return or not.  When <code>async</code> is set to <code>true</code>, the client will not block when a request is sent to the server, so other task requests can be made before the results are received asynchronously and handled by the callback.</p>
<h2 id="olive-java-api-code-samples">OLIVE Java API Code Samples</h2>
<p>The OLIVE Java API includes functionality to accommodate many of the available request messages. Utilities such as <code>requestFrameScore()</code>, <code>requestRegionScores()</code>, <code>requestEnrollClass()</code>, etc. not only do the packaging of request messages, but also take care of sending the request messages to the server, all in one call.  They are available from the class <code>com.sri.speech.olive.api.utils.ClientUtils</code>.</p>
<p>The required parameters to send many of these requests include:</p>
<ul>
<li>server handle (server - <a href="#establish-server-connection">see here</a>)</li>
<li>the plugin handle (pd - <a href="#request-available-plugins">see here</a>)</li>
<li>the name of the audio file to submit to the server (filename)</li>
<li>channel number of the audio to be processed when audio has more than 1 channel (channelNumber)</li>
<li>a callback function for handling results returned either asynchronously or synchronously (rc)</li>
<li>whether the client will block for task result to return (async - <a href="#synchronous-vs-asynchronous-message-submission">see here</a>)</li>
<li>an enum of how to submit audio to the server (transferType)</li>
<li>optional lists of annotations of the submitted audio (regions)</li>
<li>optional list of parameters for customizing plugin behavior (options)</li>
<li>optional list of class IDs for filtering the results (classIDs)</li>
</ul>
<p>Performing an enrollment request adds an additional parameter:</p>
<ul>
<li>the ID of the class to be enrolled</li>
</ul>
<p>The primary requests covered below are:</p>
<ul>
<li><a href="#frame-score-request">Frame score requests</a> - used to make some SAD requests (note that some SAD plugins return regions, not frame scores - most are capable of performing both)</li>
<li><a href="#global-score-request">Global score requests</a> - used to make LID, SID, or GID score requests</li>
<li><a href="#region-score-request">Region score requests</a> - used to make ASR, SDD, LDD, QBE, and often SAD score requests</li>
<li><a href="#enrollment-request">Enrollment requests</a> - used to enroll speakers or other class types for plugins that support the ClassEnroller trait</li>
</ul>
<h3 id="frame-score-request"><strong>Frame Score Request</strong></h3>
<p>The example below provides sample code for a function <code>handleMySADFrameScorerRequest</code> that takes a server connection, a plugin/domain handle, and a path to an audio file as arguments, and uses this information to build and submit a Frame scoring request to the connected server.</p>
<!-- This example is taken from api/reference/java/.../MySADFrameScorer.java -->
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">handleMySADFrameScorerRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span> <span class="n">String</span> <span class="n">filename</span><span class="p">)</span>
        <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Create a callback to handle SAD results from the server</span>
    <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// output frame scores</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScores</span> <span class="n">fs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getResultList</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Received %d frame scores for &#39;%s&#39;&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="na">getScoreCount</span><span class="p">(),</span>
                            <span class="n">fs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">()));</span>
                    <span class="n">Double</span><span class="o">[]</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="na">getScoreList</span><span class="p">().</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">Double</span><span class="o">[</span><span class="n">fs</span><span class="p">.</span><span class="na">getScoreList</span><span class="p">().</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">);</span>
                    <span class="kt">int</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="na">getFrameRate</span><span class="p">();</span>
                    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">scores</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">scores</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">rate</span><span class="p">);</span>
                            <span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">rate</span><span class="p">);</span>
                            <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;start: &#39;%d&#39; end: &#39;%d&#39; score:&#39;%f&#39;&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scores</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">));</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestFrameScore</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
            <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">This code passes the audio to the server using a serialized buffer. It is also possible to perform this request using buffered audio samples or a file path.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Only a plugin that support the FrameScorer trait can handle  this request.  All SAD plugins support FrameScorer, while some also SAD plugins also support the RegionScorer trait.</p>
</div>
<p>The method signature for <code>ClientUtils.requestFrameScore</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">requestFrameScore</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span>
    <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span>
    <span class="n">String</span> <span class="n">filename</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">channelNumber</span><span class="p">,</span>
    <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span><span class="p">,</span>
    <span class="kt">boolean</span> <span class="n">async</span><span class="p">,</span>
    <span class="n">AudioTransferType</span> <span class="n">transferType</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">RegionWord</span><span class="o">&gt;</span> <span class="n">regions</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">options</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">classIDs</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> 
</code></pre></div>
<p>For a complete example of how to call this code with a specific plugin, refer to the <a href="#sad-scoring-request">SAD Scoring Request</a> code example below. It contains the full Java code file this example was pulled from, showing the process of establishing a server connection, polling the server for available plugins to retrieve the appropriate plugin/domain handle, and making the request.</p>
<h3 id="global-score-request"><strong>Global Score Request</strong></h3>
<p>The example below provides sample code for a function <code>handleMyLIDGlobalScorerRequest</code> that takes a server connection, a plugin/domain handle, and a path to an audio file as arguments, and uses this information to build and submit a Global scoring request to the connected server.</p>
<!-- This example is taken from api/reference/java/.../MyLIDGlobalScorer.java -->
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">handleMyLIDGlobalScorerRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span> <span class="n">String</span> <span class="n">filename</span><span class="p">)</span>
        <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Create a callback to handle LID results from the server</span>
    <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// output LID global scores</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Received {} scores:&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreCount</span><span class="p">());</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScore</span> <span class="n">gs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreList</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;%s = %f&quot;</span><span class="p">,</span> <span class="n">gs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">(),</span> <span class="n">gs</span><span class="p">.</span><span class="na">getScore</span><span class="p">()));</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Global scorer error: {%s}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
            <span class="p">}</span>

            <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestGlobalScore</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">GLOBAL_SCORER</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
            <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">This code passes the audio to the server using a serialized buffer. It is also possible to perform this request using buffered audio samples or a file path.</p>
</div>
<div class="admonition info">
<p class="admonition-title">The code required to submit a GlobalScorerRequest message doesn't care what type of plugin is going to be doing the scoring, as long as the plugin implements the GlobalScorer Trait. This means that the exact same code can be used for submitting audio to global scoring LID plugins, SID plugins, or any other global scoring plugin.</p>
</div>
<p>The method signature for <code>ClientUtils.requestGlobalScore</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">requestGlobalScore</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span>
    <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">plugin</span><span class="p">,</span>
    <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span> <span class="n">trait</span><span class="p">,</span>
    <span class="n">String</span> <span class="n">filename</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">channelNumber</span><span class="p">,</span>
    <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span><span class="p">,</span>
    <span class="kt">boolean</span> <span class="n">async</span><span class="p">,</span> <span class="n">AudioTransferType</span> <span class="n">transferType</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">RegionWord</span><span class="o">&gt;</span> <span class="n">regions</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">options</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">classIDs</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span>
</code></pre></div>
<!--
TODO: 
Mention/show alternatives 
- Options
- Audio as file, buffer, serialized buffer
- Async vs sync
- Stereo 
-->

<h3 id="region-score-request"><strong>Region Score Request</strong></h3>
<p>The example below provides sample code for a function <code>handleMyRegionScorerRequest</code> that takes a server connection, a plugin/domain handle, and a path to an audio file as arguments, and uses this information to build and submit a Region scoring request to the connected server.</p>
<!-- This example is taken from reference/api/java/.../MyASRRegionScorer.java -->
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">handleMyRegionScorerRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span> <span class="n">String</span> <span class="n">filename</span><span class="p">)</span>
        <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Create a callback to handle results from the server</span>
    <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// do something with the results:</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Received {} region scores:&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getRegionCount</span><span class="p">());</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScore</span> <span class="n">rs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getRegionList</span><span class="p">())</span> <span class="p">{</span>

                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;{} ({}-{}secs, score={})&quot;</span><span class="p">,</span> <span class="n">rs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">(),</span> <span class="n">rs</span><span class="p">.</span><span class="na">getScore</span><span class="p">(),</span> <span class="n">rs</span><span class="p">.</span><span class="na">getStartT</span><span class="p">(),</span>
                            <span class="n">rs</span><span class="p">.</span><span class="na">getEndT</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Region scoring error: {}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">());</span>
            <span class="p">}</span>
            <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestRegionScores</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span>
            <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>

<span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">This code passes the audio to the server using a serialized buffer.  It is also possible to perform this request using file path or a serialized file.</p>
</div>
<p>The method signature for <code>ClientUtils.requestRegionScore</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">requestRegionScores</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">plugin</span><span class="p">,</span>
    <span class="n">String</span> <span class="n">filename</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">channelNumber</span><span class="p">,</span>
    <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span><span class="p">,</span>
    <span class="kt">boolean</span> <span class="n">async</span><span class="p">,</span>
    <span class="n">AudioTransferType</span> <span class="n">transferType</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">RegionWord</span><span class="o">&gt;</span> <span class="n">regions</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">options</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">classIDs</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span> 
</code></pre></div>
<p>For a complete example of how to call this code with a specific plugin, refer to the <a href="#asr-scoring-request">ASR Scoring Request</a> code example below. It contains the full Java code file this example was pulled from, showing the process of establishing a server connection, polling the server to retrieve the appropriate plugin/domain handle, and making the request.</p>
<h3 id="enrollment-request"><strong>Enrollment Request</strong></h3>
<p>The example below provides sample code for a function <code>handleMyEnrollmentRequest</code> that takes a server connection, a plugin/domain handle, the name of the class (speaker) to enroll, and a path to an audio file as arguments, and uses this information to build and submit a Region Scoring request to the connected server.</p>
<!-- This example is taken from both api/reference/java/.../MyLIDEnrollmentAndScore.java and api/reference/java/.../MySIDEnrollmentAndScore.java -->
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">handleMyEnrollmentRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span>
        <span class="n">String</span> <span class="n">speakerName</span><span class="p">,</span> <span class="n">String</span> <span class="n">enrollmentFileName</span><span class="p">)</span>
        <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// create a callback that handles the enrollment result from the server</span>
    <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span> <span class="n">enrollmentCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// examine enrollment result</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Enrollment succeeded&quot;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Enrollment request failed: {}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="c1">// make it a synchronized call, so we know the speaker is enrolled before we</span>
    <span class="kt">boolean</span> <span class="n">enrolled</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestEnrollClass</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">speakerName</span><span class="p">,</span> <span class="n">enrollmentFileName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">enrollmentCallback</span><span class="p">,</span>
            <span class="kc">false</span><span class="p">,</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">DataType</span><span class="p">.</span><span class="na">AUDIO_DATA</span><span class="p">,</span> <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span>
            <span class="n">enrollmentOptions</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">enrolled</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>The method signature for <code>ClientUtils.requestEnrollClass</code> is:</p>
<div class="highlight"><pre><span></span><code><span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">requestEnrollClass</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span>
    <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span>
    <span class="n">String</span> <span class="n">id</span><span class="p">,</span>
    <span class="n">String</span> <span class="n">wavePath</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">channelNumber</span><span class="p">,</span>
    <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span> <span class="n">rc</span><span class="p">,</span>
    <span class="kt">boolean</span> <span class="n">async</span><span class="p">,</span>
    <span class="n">DataType</span> <span class="n">dataType</span><span class="p">,</span>
    <span class="n">AudioTransferType</span> <span class="n">transferType</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">RegionWord</span><span class="o">&gt;</span> <span class="n">regions</span><span class="p">,</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">options</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">ClientException</span>
</code></pre></div>
<hr />
<h2 id="plugin-specific-code-examples">Plugin Specific Code Examples</h2>
<p>This section shows examples of using the functions just outlined to make calls to specific plugins, and demonstrate how the same code can be reused for several purposes - for example, <code>requestGlobalScore</code> is valid to request scoring from both SID and LID plugins.</p>
<ul>
<li><a href="#sad-scoring-request">SAD Scoring Example</a></li>
<li><a href="#sid-enrollment-and-scoring-request">SID Enrollment and Scoring Example</a></li>
<li><a href="#lid-enrollment-and-scoring-request">LID Enrollment and Scoring Example</a></li>
<li><a href="#asr-scoring-request">ASR Scoring Example</a></li>
<li><a href="#tmt-request">TMT Scoring Example</a> </li>
<li><a href="#sad-adaptation-request">SAD Adaptation Example</a></li>
</ul>
<h3 id="sad-scoring-request"><strong>SAD Scoring Request</strong></h3>
<p>This shows a full implementation of a client program which sends a frame scoring request to a SAD plugin.  Upon return of the result, it outputs the received frame scores.  Included also is a second version where a threshold is used to filter out frame scores which are higher.</p>
<!-- This example is taken from api/reference/java/.../MySADFrameScorer.java -->
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Server</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.ClientUtils.AudioTransferType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.client.*</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.sound.sampled.UnsupportedAudioFileException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySADFrameScorer</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">MySADFrameScorer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SERVERNAME</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">5588</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">domainName</span> <span class="o">=</span> <span class="s">&quot;multi-v1&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="s">&quot;sad-dnn-v8.0.0&quot;</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">// audio file name is passed as an argument</span>
        <span class="n">String</span> <span class="n">audioFileName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>

        <span class="c1">// Setup the connection to the OLIVE server</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
        <span class="n">server</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">TIMEOUT</span><span class="p">);</span> <span class="c1">// may need to adjust timeout</span>

        <span class="c1">// wait for the connection</span>
        <span class="kt">long</span> <span class="n">start_t</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_t</span> <span class="o">&lt;</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">synchronized</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">wait</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Keep waiting</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// report if connection fails</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to connect to the OLIVE server: {}&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;Unable to connect to server&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// ask the server for a list of current plugins</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;&gt;</span> <span class="n">pluginList</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestPlugins</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

        <span class="c1">// from the list of plugins, find the targeted plugin for the task</span>
        <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">findPluginDomainByTrait</span><span class="p">(</span><span class="n">pluginName</span><span class="p">,</span> <span class="n">domainName</span><span class="p">,</span> <span class="s">&quot;SAD&quot;</span><span class="p">,</span>
                <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">FRAME_SCORER</span><span class="p">,</span> <span class="n">pluginList</span><span class="p">);</span>

        <span class="c1">// formulate SAD frame scoring request and send to server</span>
        <span class="n">handleMySADFrameScorerRequest</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">audioFileName</span><span class="p">);</span>

    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">handleMySADFrameScorerRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span> <span class="n">String</span> <span class="n">filename</span><span class="p">)</span>
            <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Create a callback to handle SAD results from the server</span>
        <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// output frame scores</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">FrameScores</span> <span class="n">fs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getResultList</span><span class="p">())</span> <span class="p">{</span>
                        <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Received %d frame scores for &#39;%s&#39;&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="na">getScoreCount</span><span class="p">(),</span>
                                <span class="n">fs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">()));</span>
                        <span class="n">Double</span><span class="o">[]</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="na">getScoreList</span><span class="p">().</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">Double</span><span class="o">[</span><span class="n">fs</span><span class="p">.</span><span class="na">getScoreList</span><span class="p">().</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">);</span>
                        <span class="kt">int</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="na">getFrameRate</span><span class="p">();</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">scores</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">rate</span><span class="p">);</span>
                            <span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">rate</span><span class="p">);</span>
                            <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;start: &#39;%d&#39; end: &#39;%d&#39; score:&#39;%f&#39;&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scores</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">));</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>

                <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestFrameScore</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>
                <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<p>The code above outputs all frame scores of the input audio, this can generate massive amount of output, especially when the audio is long.  One good way to trim down the output is to filter out regions with frame scores higher than a preset threshold value.  The following shows how this can be done using a threshold of 0.0.</p>
<div class="highlight"><pre><span></span><code><span class="p">...</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">scores</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">scores</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// only print with score 0.0 or greater!!!</span>
        <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">rate</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">rate</span><span class="p">);</span>
        <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;start: &#39;%d&#39; end: &#39;%d&#39; score:&#39;%f&#39;&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">scores</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="p">...</span>
</code></pre></div>
<h3 id="sid-enrollment-and-scoring-request"><strong>SID Enrollment and Scoring Request</strong></h3>
<p>This example is a full implementation of a client program which sends an enrollment request to a SID plugin, followed by a scoring request to the same SID plugin.</p>
<!-- This example is taken from api/reference/java/.../MySIDEnrollmentAndScore.java -->
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Server</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.ClientUtils.AudioTransferType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.parser.RegionParser</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.client.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.sound.sampled.UnsupportedAudioFileException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySIDEnrollmentAndScore</span> <span class="p">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">MySIDEnrollmentAndScore</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SERVERNAME</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">5588</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">domainName</span> <span class="o">=</span> <span class="s">&quot;multi-v1&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="s">&quot;sid-dplda-v3.0.0&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">speakerName</span> <span class="o">=</span> <span class="s">&quot;EDMUND_YAO&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">enrollmentOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">RegionParser</span> <span class="n">regionParser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RegionParser</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">// enrollment file name is passed in as an argument</span>
        <span class="n">String</span> <span class="n">enrollmentFileName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="n">String</span> <span class="n">scoreWaveFileName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>

        <span class="c1">// Setup the connection to the OLIVE server</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
        <span class="n">server</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">TIMEOUT</span><span class="p">);</span> <span class="c1">// may need to adjust timeout</span>

        <span class="c1">// wait for the connection</span>
        <span class="kt">long</span> <span class="n">start_t</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_t</span> <span class="o">&lt;</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">synchronized</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">wait</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Keep waiting</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// report if connection fails</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to connect to the OLIVE server: {}&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;Unable to connect to server&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// ask the server for a list of current plugins</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;&gt;</span> <span class="n">pluginList</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestPlugins</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

        <span class="c1">// obtain SID plugin handle</span>
        <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">findPluginDomainByTrait</span><span class="p">(</span><span class="n">pluginName</span><span class="p">,</span> <span class="n">domainName</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
                <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">CLASS_ENROLLER</span><span class="p">,</span> <span class="n">pluginList</span><span class="p">);</span>

        <span class="c1">// perform SID enrollment task</span>
        <span class="kt">boolean</span> <span class="n">enrolled</span> <span class="o">=</span> <span class="n">handleMyEnrollmentRequest</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">speakerName</span><span class="p">,</span> <span class="n">enrollmentFileName</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">enrolled</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// make a region score request</span>
            <span class="n">handleMyRegionScoreRequest</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">speakerName</span><span class="p">,</span> <span class="n">scoreWaveFileName</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">handleMyEnrollmentRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span>
            <span class="n">String</span> <span class="n">speakerName</span><span class="p">,</span> <span class="n">String</span> <span class="n">enrollmentFileName</span><span class="p">)</span>
            <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// create a callback that handles the enrollment result from the server</span>
        <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span> <span class="n">enrollmentCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// examine enrollment result</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Enrollment succeeded&quot;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Enrollment request failed: {}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="c1">// make it a synchronized call, so we know the speaker is enrolled before we</span>
        <span class="kt">boolean</span> <span class="n">enrolled</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestEnrollClass</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">speakerName</span><span class="p">,</span> <span class="n">enrollmentFileName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">enrollmentCallback</span><span class="p">,</span>
                <span class="kc">false</span><span class="p">,</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">DataType</span><span class="p">.</span><span class="na">AUDIO_DATA</span><span class="p">,</span> <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span>
                <span class="n">enrollmentOptions</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">enrolled</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleMyRegionScoreRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span>
            <span class="n">String</span> <span class="n">speakerName</span><span class="p">,</span> <span class="n">String</span> <span class="n">scoreWaveFileName</span><span class="p">)</span>
            <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

        <span class="c1">// Create a call back to handle the SID scoring request</span>
        <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">scoreCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// do something with the results:</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Received {} scores:&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreCount</span><span class="p">());</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScore</span> <span class="n">gs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreList</span><span class="p">())</span> <span class="p">{</span>
                        <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;speaker{%s} = {%f}&quot;</span><span class="p">,</span> <span class="n">gs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">(),</span> <span class="n">gs</span><span class="p">.</span><span class="na">getScore</span><span class="p">()));</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Global scorer error: {%s}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
                <span class="p">}</span>
                <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">};</span>

        <span class="c1">// SID is a global scorer, so make a global score reqeust:</span>
        <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestGlobalScore</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">GLOBAL_SCORER</span><span class="p">,</span> <span class="n">scoreWaveFileName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">scoreCallback</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span>
                <span class="n">regionParser</span><span class="p">.</span><span class="na">getRegions</span><span class="p">(</span><span class="n">scoreWaveFileName</span><span class="p">),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="lid-enrollment-and-scoring-request"><strong>LID Enrollment and Scoring Request</strong></h3>
<p><a name="sync-lid-enrollment-and-scoring-example"></a></p>
<p>This example is a full implementation of a client program which sends an enrollment request to a LID plugin, followed by a scoring request to the same LID plugin.</p>
<!-- This example is taken from MyLIDEnrollmentAndScore.java -->
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Server</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.ClientUtils.AudioTransferType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.client.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.sound.sampled.UnsupportedAudioFileException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyLIDEnrollmentAndScore</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">MyLIDEnrollmentAndScore</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SERVERNAME</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">5588</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">domainName</span> <span class="o">=</span> <span class="s">&quot;multi-v1&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="s">&quot;lid-embedplda-v4.0.0&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">languageName</span> <span class="o">=</span> <span class="s">&quot;Esperanto&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">enrollmentOptions</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

        <span class="c1">// enrollment file name is passed in as an argument</span>
        <span class="n">String</span> <span class="n">enrollmentFileName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>
        <span class="n">String</span> <span class="n">scoreWaveFileName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="p">;</span>

        <span class="c1">// Setup the connection to the OLIVE server</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
        <span class="n">server</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">TIMEOUT</span><span class="p">);</span> <span class="c1">// may need to adjust timeout</span>

        <span class="c1">// wait for the connection</span>
        <span class="kt">long</span> <span class="n">start_t</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_t</span> <span class="o">&lt;</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">synchronized</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">wait</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Keep waiting</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// report if connection fails</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to connect to the OLIVE server: {}&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;Unable to connect to server&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// ask the server for a list of current plugins</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;&gt;</span> <span class="n">pluginList</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestPlugins</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

        <span class="c1">// obtain LID plugin handle</span>
        <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">findPluginDomainByTrait</span><span class="p">(</span><span class="n">pluginName</span><span class="p">,</span> <span class="n">domainName</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>
                <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">CLASS_ENROLLER</span><span class="p">,</span> <span class="n">pluginList</span><span class="p">);</span>

        <span class="c1">// perform LID enrollment task</span>
        <span class="kt">boolean</span> <span class="n">enrolled</span> <span class="o">=</span> <span class="n">handleMyEnrollmentRequest</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">languageName</span><span class="p">,</span> <span class="n">enrollmentFileName</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">enrolled</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// make a region score request</span>
            <span class="n">handleMyRegionScoreRequest</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">languageName</span><span class="p">,</span> <span class="n">scoreWaveFileName</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">handleMyEnrollmentRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span>
            <span class="n">String</span> <span class="n">languageName</span><span class="p">,</span> <span class="n">String</span> <span class="n">enrollmentFileName</span><span class="p">)</span>
            <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// create a callback that handles the enrollment result from the server</span>
        <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span> <span class="n">enrollmentCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassModificationResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// examine enrollment result</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Enrollment succeeded&quot;</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Enrollment request failed: {}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">());</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="c1">// make it a synchronized call, so we know the language is enrolled before we</span>
        <span class="kt">boolean</span> <span class="n">enrolled</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestEnrollClass</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">languageName</span><span class="p">,</span> <span class="n">enrollmentFileName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">enrollmentCallback</span><span class="p">,</span>
                <span class="kc">false</span><span class="p">,</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">DataType</span><span class="p">.</span><span class="na">AUDIO_DATA</span><span class="p">,</span> <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span>
                <span class="n">enrollmentOptions</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">enrolled</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">handleMyRegionScoreRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span>
            <span class="n">String</span> <span class="n">languageName</span><span class="p">,</span> <span class="n">String</span> <span class="n">scoreWaveFileName</span><span class="p">)</span>
            <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

        <span class="c1">// Create a call back to handle the LID scoring request</span>
        <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">scoreCallback</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// do something with the results:</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Received {} scores:&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreCount</span><span class="p">());</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">GlobalScore</span> <span class="n">gs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreList</span><span class="p">())</span> <span class="p">{</span>
                        <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;language{%s} = {%f}&quot;</span><span class="p">,</span> <span class="n">gs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">(),</span> <span class="n">gs</span><span class="p">.</span><span class="na">getScore</span><span class="p">()));</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Global scorer error: {%s}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
                <span class="p">}</span>
                <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>

        <span class="p">};</span>

        <span class="c1">// LID is a global scorer, so make a global score reqeust:</span>
        <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestGlobalScore</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">GLOBAL_SCORER</span><span class="p">,</span> <span class="n">scoreWaveFileName</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                <span class="n">scoreCallback</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span>
                <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="asr-scoring-request"><strong>ASR Scoring Request</strong></h3>
<p>The following example shows a full implementation of a ASR scoring request.  It sends a <a href="apiMessage.html#regionscorerrequest"><code>RegionScorerRequest</code></a> and receives a <a href="apiMessage.html#regionscorerresult"><code>RegionScorerResult</code></a>.</p>
<!-- This example is taken from api/reference/java/.../MyASRRegionScorer.java -->
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Server</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.ClientUtils.AudioTransferType</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.client.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">javax.sound.sampled.UnsupportedAudioFileException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.io.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyASRRegionScorer</span> <span class="p">{</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">MyASRRegionScorer</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SERVERNAME</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">5588</span><span class="p">;</span>

<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">domainName</span> <span class="o">=</span> <span class="s">&quot;english-tdnnLookaheadRnnlm-tel-v2&quot;</span><span class="p">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="s">&quot;asr-dynapy-v4.1.0&quot;</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>

    <span class="c1">// audio file name is passed as an argument</span>
    <span class="n">String</span> <span class="n">audioFileName</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>

    <span class="c1">// Setup the connection to the (scenic) server</span>
    <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
    <span class="n">server</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">,</span>
            <span class="n">DEFAULT_PORT</span><span class="p">,</span>
            <span class="n">DEFAULT_PORT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">TIMEOUT</span><span class="p">);</span>

    <span class="c1">// wait for the connection</span>
    <span class="kt">long</span> <span class="n">start_t</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_t</span> <span class="o">&lt;</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">synchronized</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">wait</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Keep waiting</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// report if connection fails</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to connect to the OLIVE server: {}&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">);</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;Unable to connect to server&quot;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// ask the server for a list of current plugins</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;&gt;</span> <span class="n">pluginList</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestPlugins</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

    <span class="c1">// formulate the frame scoring task request</span>
    <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">findPluginDomainByTrait</span><span class="p">(</span><span class="n">pluginName</span><span class="p">,</span> <span class="n">domainName</span><span class="p">,</span> <span class="s">&quot;ASR&quot;</span><span class="p">,</span>
            <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">REGION_SCORER</span><span class="p">,</span> <span class="n">pluginList</span><span class="p">);</span>

    <span class="c1">// Perform ASR frame scoring task</span>
    <span class="n">handleMyRegionScorerRequest</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">audioFileName</span><span class="p">);</span>

    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">handleMyRegionScorerRequest</span><span class="p">(</span><span class="n">Server</span> <span class="n">server</span><span class="p">,</span> <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span><span class="p">,</span> <span class="n">String</span> <span class="n">filename</span><span class="p">)</span>
            <span class="kd">throws</span> <span class="n">ClientException</span><span class="p">,</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">UnsupportedAudioFileException</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">pd</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// Create a callback to handle results from the server</span>
        <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">RegionScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

                <span class="c1">// do something with the results:</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Received {} region scores:&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getRegionCount</span><span class="p">());</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">RegionScore</span> <span class="n">rs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getRegionList</span><span class="p">())</span> <span class="p">{</span>

                        <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;{} ({}-{}secs, score={})&quot;</span><span class="p">,</span> <span class="n">rs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">(),</span> <span class="n">rs</span><span class="p">.</span><span class="na">getScore</span><span class="p">(),</span> <span class="n">rs</span><span class="p">.</span><span class="na">getStartT</span><span class="p">(),</span>
                                <span class="n">rs</span><span class="p">.</span><span class="na">getEndT</span><span class="p">());</span>
                    <span class="p">}</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Region scoring error: {}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">());</span>
                <span class="p">}</span>
                <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestRegionScores</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="n">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span>
                <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">());</span>

    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="tmt-request"><strong>TMT Request</strong></h3>
<p>The following code shows a full implementation of a text machine translation request made to a TMT plugin.  The request in this client is a <code>TextTransformationRequest</code>.</p>
<!-- This request is taken from api/reference/java/.../MyTMTRequest.java -->
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">java.util.List</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Server</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.client.ClientException</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.ClientUtils</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.Pair</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTMTRequest</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">MyTMTRequest</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SERVERNAME</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">5588</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="s">&quot;tmt-neural-v1.1.1&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">domainName</span> <span class="o">=</span> <span class="s">&quot;cmn-eng-nmt-v1&quot;</span><span class="p">;</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">ClientException</span> <span class="p">{</span>
        <span class="c1">// input text is passed as an argument</span>
        <span class="n">String</span> <span class="n">inputText</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>

        <span class="c1">// establish server connection</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
        <span class="n">server</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span>
            <span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="c1">//client-id</span>
            <span class="n">DEFAULT_SERVERNAME</span><span class="p">,</span>  <span class="c1">//address of server</span>
            <span class="n">DEFAULT_PORT</span><span class="p">,</span>  <span class="c1">//request-port</span>
            <span class="n">DEFAULT_PORT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1">//status-port</span>
            <span class="n">TIMEOUT</span>  <span class="c1">//timeout for failed connection request</span>
        <span class="p">);</span>

        <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;&gt;</span> <span class="n">pluginList</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestPlugins</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
        <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pluginDomainPair</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">findPluginDomain</span><span class="p">(</span><span class="n">pluginName</span><span class="p">,</span> <span class="n">domainName</span><span class="p">,</span> <span class="n">pluginList</span><span class="p">);</span>

        <span class="c1">// build the request</span>
        <span class="n">Olive</span><span class="p">.</span><span class="na">TextTransformationRequest</span><span class="p">.</span><span class="na">Builder</span> <span class="n">req</span> <span class="o">=</span> <span class="n">Olive</span><span class="p">.</span><span class="na">TextTransformationRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
                <span class="p">.</span><span class="na">setText</span><span class="p">(</span><span class="n">inputText</span><span class="p">)</span>
                <span class="p">.</span><span class="na">setPlugin</span><span class="p">(</span><span class="n">pluginDomainPair</span><span class="p">.</span><span class="na">getFirst</span><span class="p">().</span><span class="na">getId</span><span class="p">())</span>
                <span class="p">.</span><span class="na">setDomain</span><span class="p">(</span><span class="n">pluginDomainPair</span><span class="p">.</span><span class="na">getSecond</span><span class="p">().</span><span class="na">getId</span><span class="p">());</span>

        <span class="c1">// submit request</span>
        <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Submitting %s for translation with plugin %s and domain %s&quot;</span><span class="p">,</span> <span class="n">inputText</span><span class="p">,</span> <span class="n">pluginDomainPair</span><span class="p">.</span><span class="na">getFirst</span><span class="p">().</span><span class="na">getId</span><span class="p">(),</span> <span class="n">pluginDomainPair</span><span class="p">.</span><span class="na">getSecond</span><span class="p">().</span><span class="na">getId</span><span class="p">()));</span>
        <span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">TextTransformationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">TextTransformationResult</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="na">synchRequest</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>

        <span class="c1">// handle response</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">result</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">for</span><span class="p">(</span><span class="n">Olive</span><span class="p">.</span><span class="na">TextTransformation</span> <span class="n">transformation</span> <span class="p">:</span> <span class="n">result</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getTransformationList</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">transformation</span><span class="p">.</span><span class="na">getTransformedText</span><span class="p">());</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Translation error&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
        <span class="p">}</span>

        <span class="c1">// disconnect</span>
        <span class="n">server</span><span class="p">.</span><span class="na">disconnect</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div>
<h3 id="sad-adaptation-request"><strong>SAD Adaptation Request</strong></h3>
<p>Below is a full implementation of a SAD request to adapt a new domain from an existing domain.  The list of adaptation training files is passed into the client as a file.  The code handles both supervised (speech regions specified) and unsupervised (speech regions not specified) SAD adaptations.  However, some SAD plugins may not have the unsupervised adaptation capability, in which case the client will exit with a failure message.</p>
<!-- This example is taken from api/reference/java/.../MySADAdaptation.java -->
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Server</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive.AnnotationRegion</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive.AudioAnnotation</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive.Domain</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.Olive.Plugin</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.*</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.sri.speech.olive.api.utils.parser.LearningParser</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">org.slf4j.Logger</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">org.slf4j.LoggerFactory</span><span class="p">;</span>

<span class="kn">import</span> <span class="nn">java.util.*</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySADAdaptation</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">LoggerFactory</span><span class="p">.</span><span class="na">getLogger</span><span class="p">(</span><span class="n">MySADAdaptation</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">TIMEOUT</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DEFAULT_SERVERNAME</span> <span class="o">=</span> <span class="s">&quot;localhost&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">DEFAULT_PORT</span> <span class="o">=</span> <span class="mi">5588</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">domainName</span> <span class="o">=</span> <span class="s">&quot;multi-v1&quot;</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">pluginName</span> <span class="o">=</span> <span class="s">&quot;sad-dnn-v8.0.0&quot;</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="n">newDomainName</span> <span class="o">=</span> <span class="s">&quot;custom-v1&quot;</span><span class="p">;</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="n">LearningParser</span> <span class="n">learningParser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LearningParser</span><span class="p">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="c1">// audio file list is passed as an argument</span>
        <span class="n">String</span> <span class="n">audioFileList</span> <span class="o">=</span> <span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span><span class="p">;</span>

        <span class="c1">// parse files in list</span>
        <span class="n">learningParser</span><span class="p">.</span><span class="na">parse</span><span class="p">(</span><span class="n">audioFileList</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">learningParser</span><span class="p">.</span><span class="na">isValid</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Invalid input file: &quot;</span> <span class="o">+</span> <span class="n">audioFileList</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Setup the connection to the OLIVE server</span>
        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">();</span>
        <span class="n">server</span><span class="p">.</span><span class="na">connect</span><span class="p">(</span><span class="s">&quot;exampleClient&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span><span class="p">,</span>
                <span class="n">DEFAULT_PORT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">TIMEOUT</span><span class="p">);</span> <span class="c1">// may need to adjust timeout</span>

        <span class="c1">// wait for the connection</span>
        <span class="kt">long</span> <span class="n">start_t</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">();</span>
        <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_t</span> <span class="o">&lt;</span> <span class="n">TIMEOUT</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="kd">synchronized</span> <span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">wait</span><span class="p">(</span><span class="n">TIMEOUT</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Keep waiting</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// report if connection fails</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">server</span><span class="p">.</span><span class="na">getConnected</span><span class="p">().</span><span class="na">get</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to connect to the OLIVE server: {}&quot;</span><span class="p">,</span> <span class="n">DEFAULT_SERVERNAME</span><span class="p">);</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">Exception</span><span class="p">(</span><span class="s">&quot;Unable to connect to server&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// ask the server for a list of current plugins</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;&gt;</span> <span class="n">pluginList</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestPlugins</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>

        <span class="c1">// from the list of plugins, find the targeted plugin for the task</span>
        <span class="n">Pair</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">Plugin</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">Domain</span><span class="o">&gt;</span> <span class="n">pd</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">findPluginDomainByTrait</span><span class="p">(</span><span class="n">pluginName</span><span class="p">,</span> <span class="n">domainName</span><span class="p">,</span> <span class="s">&quot;SAD&quot;</span><span class="p">,</span>
                <span class="n">learningParser</span><span class="p">.</span><span class="na">isUnsupervised</span><span class="p">()</span> <span class="o">?</span> <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">UNSUPERVISED_ADAPTER</span>
                        <span class="p">:</span> <span class="n">Olive</span><span class="p">.</span><span class="na">TraitType</span><span class="p">.</span><span class="na">SUPERVISED_ADAPTER</span><span class="p">,</span>
                <span class="n">pluginList</span><span class="p">);</span>

        <span class="c1">// Preproces audio - doesn&#39;t matter if supervised or unsupervised</span>
        <span class="n">String</span> <span class="n">adaptID</span> <span class="o">=</span> <span class="n">UUID</span><span class="p">.</span><span class="na">randomUUID</span><span class="p">().</span><span class="na">toString</span><span class="p">();</span>
        <span class="n">Plugin</span> <span class="n">plugin</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="na">getFirst</span><span class="p">();</span>
        <span class="n">Domain</span> <span class="n">domain</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="na">getSecond</span><span class="p">();</span>

        <span class="c1">// optional annotations, generated if found in the parser (supervised</span>
        <span class="c1">// adaptation)</span>
        <span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">AudioAnnotation</span><span class="o">&gt;&gt;</span> <span class="n">annotations</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>

        <span class="kt">int</span> <span class="n">numPreprocessed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">filename</span> <span class="p">:</span> <span class="n">learningParser</span><span class="p">.</span><span class="na">getFilenames</span><span class="p">())</span> <span class="p">{</span>

            <span class="k">try</span> <span class="p">{</span>
                <span class="c1">// build the audio</span>
                <span class="n">Olive</span><span class="p">.</span><span class="na">Audio</span><span class="p">.</span><span class="na">Builder</span> <span class="n">audio</span> <span class="o">=</span> <span class="n">ClientUtils</span><span class="p">.</span><span class="na">createAudioFromFile</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">ClientUtils</span><span class="p">.</span><span class="na">AudioTransferType</span><span class="p">.</span><span class="na">SEND_SERIALIZED_BUFFER</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>

                <span class="c1">// build up request metadata</span>
                <span class="n">String</span> <span class="n">id</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                <span class="n">Collection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">classIDs</span> <span class="o">=</span> <span class="n">learningParser</span><span class="p">.</span><span class="na">getAnnotations</span><span class="p">(</span><span class="n">filename</span><span class="p">).</span><span class="na">keySet</span><span class="p">();</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">classIDs</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">id</span> <span class="o">=</span> <span class="s">&quot;supervised&quot;</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="c1">// Prepare the request</span>
                <span class="n">Olive</span><span class="p">.</span><span class="na">PreprocessAudioAdaptRequest</span><span class="p">.</span><span class="na">Builder</span> <span class="n">req</span> <span class="o">=</span> <span class="n">Olive</span><span class="p">.</span><span class="na">PreprocessAudioAdaptRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
                        <span class="p">.</span><span class="na">setPlugin</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
                        <span class="p">.</span><span class="na">setDomain</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
                        <span class="p">.</span><span class="na">setAdaptSpace</span><span class="p">(</span><span class="n">adaptID</span><span class="p">)</span>
                        <span class="c1">// We don&#39;t set the optional start/end regions... those are used later when</span>
                        <span class="c1">// we finalize</span>
                        <span class="p">.</span><span class="na">setAudio</span><span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">req</span><span class="p">.</span><span class="na">setClassId</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="c1">// send the request</span>
                <span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">PreprocessAudioAdaptRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">PreprocessAudioAdaptResult</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">server</span>
                        <span class="p">.</span><span class="na">synchRequest</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Error preprocessing audio %s because: %s&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span>
                            <span class="n">result</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">numPreprocessed</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Audio file %s successfully preprocessed&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">));</span>

                    <span class="n">String</span> <span class="n">audioId</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getAudioId</span><span class="p">();</span>

                    <span class="c1">// Set the audio ID for any classID(s) associated with this audio</span>
                    <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">classIDName</span> <span class="p">:</span> <span class="n">learningParser</span><span class="p">.</span><span class="na">getAnnotations</span><span class="p">(</span><span class="n">filename</span><span class="p">).</span><span class="na">keySet</span><span class="p">())</span> <span class="p">{</span>

                        <span class="c1">// Add the class/audio id mapping , and optionally add annotation regions</span>
                        <span class="n">List</span><span class="o">&lt;</span><span class="n">AudioAnnotation</span><span class="o">&gt;</span> <span class="n">audioAnnots</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">annotations</span><span class="p">.</span><span class="na">containsKey</span><span class="p">(</span><span class="n">classIDName</span><span class="p">))</span> <span class="p">{</span>
                            <span class="n">audioAnnots</span> <span class="o">=</span> <span class="n">annotations</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">classIDName</span><span class="p">);</span>
                        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                            <span class="n">audioAnnots</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
                            <span class="n">annotations</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">classIDName</span><span class="p">,</span> <span class="n">audioAnnots</span><span class="p">);</span>
                        <span class="p">}</span>

                        <span class="n">Olive</span><span class="p">.</span><span class="na">AudioAnnotation</span><span class="p">.</span><span class="na">Builder</span> <span class="n">aaBuilder</span> <span class="o">=</span> <span class="n">Olive</span><span class="p">.</span><span class="na">AudioAnnotation</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
                                <span class="p">.</span><span class="na">setAudioId</span><span class="p">(</span><span class="n">audioId</span><span class="p">);</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">RegionWord</span> <span class="n">word</span> <span class="p">:</span> <span class="n">learningParser</span><span class="p">.</span><span class="na">getAnnotations</span><span class="p">(</span><span class="n">filename</span><span class="p">).</span><span class="na">get</span><span class="p">(</span><span class="n">classIDName</span><span class="p">))</span> <span class="p">{</span>
                            <span class="n">AnnotationRegion</span><span class="p">.</span><span class="na">Builder</span> <span class="n">ab</span> <span class="o">=</span> <span class="n">AnnotationRegion</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
                                    <span class="p">.</span><span class="na">setStartT</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="na">getStartTimeSeconds</span><span class="p">()).</span><span class="na">setEndT</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="na">getEndTimeSeconds</span><span class="p">());</span>
                            <span class="n">aaBuilder</span><span class="p">.</span><span class="na">addRegions</span><span class="p">(</span><span class="n">ab</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
                        <span class="p">}</span>
                        <span class="n">audioAnnots</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">aaBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
                    <span class="p">}</span>

                <span class="p">}</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="cm">/* | UnsupportedAudioFileException */</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Unable to preprocess file: &quot;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">);</span>
                <span class="n">log</span><span class="p">.</span><span class="na">debug</span><span class="p">(</span><span class="s">&quot;File preprocess error: &quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// perform adaptation</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">learningParser</span><span class="p">.</span><span class="na">isUnsupervised</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">numPreprocessed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Prepare the request</span>
                <span class="n">Olive</span><span class="p">.</span><span class="na">UnsupervisedAdaptationRequest</span><span class="p">.</span><span class="na">Builder</span> <span class="n">req</span> <span class="o">=</span> <span class="n">Olive</span><span class="p">.</span><span class="na">UnsupervisedAdaptationRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
                        <span class="p">.</span><span class="na">setPlugin</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
                        <span class="p">.</span><span class="na">setDomain</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
                        <span class="p">.</span><span class="na">setAdaptSpace</span><span class="p">(</span><span class="n">adaptID</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">setNewDomain</span><span class="p">(</span><span class="n">newDomainName</span><span class="p">);</span>

                <span class="c1">// Now send the finalize request</span>
                <span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">UnsupervisedAdaptationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">UnsupervisedAdaptationResult</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">server</span>
                        <span class="p">.</span><span class="na">synchRequest</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Unsupervised adaptation failed for new domain &#39;%s&#39; because: %s&quot;</span><span class="p">,</span>
                            <span class="n">newDomainName</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;New Domain &#39;%s&#39; Adapted&quot;</span><span class="p">,</span> <span class="n">newDomainName</span><span class="p">));</span>
                <span class="p">}</span>

            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Can not adapt domain because all audio preprocessing attempts failed.&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">// supervised adaptation</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">numPreprocessed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">List</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">ClassAnnotation</span><span class="o">&gt;</span> <span class="n">classAnnotations</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>

                <span class="k">for</span> <span class="p">(</span><span class="n">String</span> <span class="n">id</span> <span class="p">:</span> <span class="n">annotations</span><span class="p">.</span><span class="na">keySet</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">Olive</span><span class="p">.</span><span class="na">ClassAnnotation</span><span class="p">.</span><span class="na">Builder</span> <span class="n">caBuilder</span> <span class="o">=</span> <span class="n">Olive</span><span class="p">.</span><span class="na">ClassAnnotation</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">().</span><span class="na">setClassId</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
                            <span class="p">.</span><span class="na">addAllAnnotations</span><span class="p">(</span><span class="n">annotations</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
                    <span class="n">classAnnotations</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">caBuilder</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>
                <span class="p">}</span>

                <span class="c1">// Prepare the request</span>
                <span class="n">Olive</span><span class="p">.</span><span class="na">SupervisedAdaptationRequest</span><span class="p">.</span><span class="na">Builder</span> <span class="n">req</span> <span class="o">=</span> <span class="n">Olive</span><span class="p">.</span><span class="na">SupervisedAdaptationRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
                        <span class="p">.</span><span class="na">setPlugin</span><span class="p">(</span><span class="n">plugin</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
                        <span class="p">.</span><span class="na">setDomain</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="na">getId</span><span class="p">())</span>
                        <span class="p">.</span><span class="na">setAdaptSpace</span><span class="p">(</span><span class="n">adaptID</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">setNewDomain</span><span class="p">(</span><span class="n">newDomainName</span><span class="p">)</span>
                        <span class="p">.</span><span class="na">addAllClassAnnotations</span><span class="p">(</span><span class="n">classAnnotations</span><span class="p">);</span>

                <span class="c1">// Now send the finalize request</span>
                <span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Olive</span><span class="p">.</span><span class="na">SupervisedAdaptationRequest</span><span class="p">,</span> <span class="n">Olive</span><span class="p">.</span><span class="na">SupervisedAdaptationResult</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">server</span>
                        <span class="p">.</span><span class="na">synchRequest</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="na">build</span><span class="p">());</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="na">hasError</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Failed to adapt new Domain &#39;%s&#39; because: %s&quot;</span><span class="p">,</span> <span class="n">newDomainName</span><span class="p">,</span>
                            <span class="n">result</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;New Domain &#39;%s&#39; Adapted&quot;</span><span class="p">,</span> <span class="n">newDomainName</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Can not adapt domain because all audio preprocessing attempts failed.&quot;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">);</span>
        <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Learning finished.  Exiting...&quot;</span><span class="p">);</span>
        <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<!-- Keep this for backup in case Chris doesn't like my changes
- [SAD Scoring Example](#sad-scoring-request) - a full implementation of a client program which sends a frame scoring request to a SAD plugin.  Upon returns of the result, it outputs the received frame scores.  Included also is a second version where a threshold is used to filter out frame scores which are higher.

- [SID Enrollment and Scoring Example](#sid-enrollment-and-scoring-example) - a full implementation of a client program which sends an enrollment request to a SID plugin, followed by a scoring request to the same SID plugin.  

- [LID Enrollment and Scoring Example (synchronized approach)](#synchronized-approach) - A LID enrollment of a new language may involve multiple enrollment files.  The synchronized version of this client waits for the server to complete the enrollment request with each enrollment file sequentially, before requesting LID scores on an input file.  

- [LID Enrollment and Scoring Example (asynchronized approach)](#asynchronized-approach) - the asynchronized version of this LID client does not wait for the last enrollment request to complete before making another.  Instead, it keeps count on server responses to enrollment requests made, and makes sure that all enrollment requests are completed before making a LID scoring request on an input file.  

- [KWS Scoring Example](#kws-scoring-request) - a full implementation of a KWS scoring request, against the list of default keywords already trained.  The client issues a [`RegionScoreRequest`](apiMessage.md#regionscorerresult) because KWS is a "RegionScorer". 

- [SDD Enrollment and Scoring Example](#sdd-enrollment-and-scoring-request) - a full implementation of a speaker enrollment request, followed by a scoring request made to a SDD plugin.  The scoring request in this client is a [`RegionScorerRequest`](apiMessage.md#regionscorerrequest) because SDD plugins are region scorers.

- [SAD Supervised Adaptation Example](#sad-supervised-adaptation-request) - a full implementation of a SAD request to adapt a new domain from an existing domain.  The list of adaptation training files is passed into the client as a file.  The code handles both supervised (speech regions specified) and unsupervised (speech regions not specified) SAD adaptations.  However, some SAD plugins may not have the unsupervised adaptation capability, in which case the client will exit with a failure message.

- [TPD Enrollment and Scoring Example](#tpd-enrollment-and-scoring-request) - a full implementation of a TPD topic enrollment request using positive examples from selected regions of an audio, followed by a scoring request of the enrolled topic on another audio.  Enrollment using negative audio samples are also included in this example as commented out lines.

-->

<!-- TODO: This didn't end up getting re-used; not important?)

###**7.  Receive and process task results**

Once a task is completed by a plugin, the plugin sends the results to the server.  The server in turn sends the results to the client.  

A common way to handle how a server hands back results to its clients is to register callback routines during task requests.  The server uses the registered callback routines to return results to the client when the results become available.  In the pseudo code below, callback() is the routine handle for the server to pass back results to the client.

Pseudo Code:

<div class="highlight"><pre><span></span><code>sendRequest(server,packageRequest(pluginName,pluginDomain,requestType,other information specific to requestType),audio,callback())    
</code></pre></div>

The OLIVE Java API employs this callback mechanism for the server to send results back to the client.  This mechanism is carried out by the client associating a callback instance with a request, and detailing what the callback instance does when the results are received.  In the example below, the callback instance rc for handling FrameScorerRequest results is defined as part of the frame scoring request class definition.  `rc` handles received results `r` as defined in the overriden `call`.  Details for outputting the returned frame scores are given a little further below.

<div class="highlight"><pre><span></span><code><span class="c1">// Create a callback that handles the frame score result from the server:</span>
<span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Scenic</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Scenic</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span>
        <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Scenic</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Scenic</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Scenic</span><span class="p">.</span><span class="na">FrameScorerRequest</span><span class="p">,</span> <span class="n">Scenic</span><span class="p">.</span><span class="na">FrameScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">//Retrieve Frame Scores</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">()){</span>

                <span class="c1">// details of outputting frame scores...</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="n">log</span><span class="p">.</span><span class="na">error</span><span class="p">(</span><span class="s">&quot;Frame score request failed: {}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">());</span>
        <span class="p">}</span>

    <span class="p">}</span>
<span class="p">};</span>
</code></pre></div>


Once the callback instance `rc` is defined, the client can send a frame scoring request using the utility `requestFrameScore()` from package com.sri.scenic.api.utils.ClientUtils, as shown below.  The regions of the audio file can be extracted using the API utility regionParser.getRegions(), available from API package com.sri.scenic.api.utils.RegionParser, which converts frame scores into regions based on a given threshold.

<div class="highlight"><pre><span></span><code><span class="n">ClientUtils</span><span class="p">.</span><span class="na">requestFrameScore</span><span class="p">(</span>
                 <span class="n">server</span><span class="p">,</span><span class="err">#</span><span class="n">server</span> <span class="n">handle</span>
                 <span class="n">pd</span><span class="p">,</span>    <span class="err">#</span><span class="n">plugin</span> <span class="n">handle</span>
             <span class="n">audio</span><span class="p">,</span> <span class="err">#</span><span class="n">path</span> <span class="n">of</span> <span class="n">audio</span> <span class="n">file</span> <span class="n">to</span> <span class="n">be</span> <span class="n">processed</span>
             <span class="mi">1</span><span class="p">,</span>     <span class="err">#</span><span class="n">channel</span> <span class="n">number</span>
             <span class="n">rc</span><span class="p">,</span>    <span class="err">#</span><span class="n">callback</span>
             <span class="kc">true</span><span class="p">,</span>  <span class="err">#</span><span class="n">async</span> <span class="n">flag</span>
             <span class="kc">true</span><span class="p">,</span>  <span class="err">#</span><span class="n">serialized</span> <span class="n">data</span> <span class="n">flag</span>
             <span class="n">regionParser</span><span class="p">.</span><span class="na">getRegions</span><span class="p">(</span><span class="n">audio</span><span class="p">),</span> <span class="err">#</span><span class="n">audio</span> <span class="n">regions</span>
             <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">(),</span> <span class="err">#</span><span class="n">list</span> <span class="n">of</span> <span class="n">other</span> <span class="n">options</span> <span class="k">for</span> <span class="n">customizing</span> <span class="n">plugin</span>
             <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">()</span>  <span class="err">#</span><span class="n">list</span> <span class="n">of</span> <span class="kd">class</span> <span class="nc">IDs</span> <span class="n">to</span> <span class="n">focus</span> <span class="n">processing</span> <span class="n">on</span>
             <span class="p">);</span>
</code></pre></div>

Upon completion of the requested task, the client will receive task results `r` from the server through the callback `rc`.  The following shows an example of retrieving results of a frame scoring request.  It extracts `fs` from `r` as a frame score list, then steps through the list to output the start and end points, and score of each frame in `fs`.  Start and end points of the frames are in seconds, based on the frame rate of the audio.  Audio frame rate can be extracted from r using the API utility getFrameRate().

<div class="highlight"><pre><span></span><code><span class="c1">//Retrieve Frame Scores</span>
<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">()){</span>
  <span class="k">for</span><span class="p">(</span><span class="n">Scenic</span><span class="p">.</span><span class="na">FrameScores</span> <span class="n">fs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getResultList</span><span class="p">())</span>
  <span class="p">{</span>
       <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Received %d frame scores for &#39;%s&#39;&quot;</span><span class="p">,</span> <span class="n">fs</span><span class="p">.</span><span class="na">getScoreCount</span><span class="p">(),</span> <span class="n">fs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">()));</span>
       <span class="n">Double</span><span class="o">[]</span> <span class="n">scores</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="na">getScoreList</span><span class="p">().</span><span class="na">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">Double</span><span class="o">[</span><span class="n">fs</span><span class="p">.</span><span class="na">getScoreList</span><span class="p">().</span><span class="na">size</span><span class="p">()</span><span class="o">]</span><span class="p">);</span>
           <span class="kt">int</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">fs</span><span class="p">.</span><span class="na">getFrameRate</span><span class="p">();</span>
           <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">scores</span><span class="p">.</span><span class="na">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
           <span class="p">{</span>
                <span class="kt">int</span> <span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">rate</span><span class="p">);</span>
                <span class="kt">int</span> <span class="n">end</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span> <span class="n">rate</span><span class="p">);</span>
                <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;start: &#39;%d&#39; end: &#39;%d&#39; score:&#39;%f&#39;&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">scores</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="p">));</span>
         <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


For a global scoring request such as a SID or LID scoring, the returned results will be of type [`GlobalScorerResult`](apiMessage.md#globalscorerresult).  In this case, the callback `rc` can extract a global score list `gs` from `r`, then step through `gs` to output each pair of class ID and score, as shown below.

<div class="highlight"><pre><span></span><code><span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Scenic</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Scenic</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">rc</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Server</span><span class="p">.</span><span class="na">ResultCallback</span><span class="o">&lt;</span><span class="n">Scenic</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Scenic</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span><span class="p">()</span> <span class="p">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">call</span><span class="p">(</span><span class="n">Server</span><span class="p">.</span><span class="na">Result</span><span class="o">&lt;</span><span class="n">Scenic</span><span class="p">.</span><span class="na">GlobalScorerRequest</span><span class="p">,</span> <span class="n">Scenic</span><span class="p">.</span><span class="na">GlobalScorerResult</span><span class="o">&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// do something with the results:                                                         </span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">r</span><span class="p">.</span><span class="na">hasError</span><span class="p">()){</span>
            <span class="n">log</span><span class="p">.</span><span class="na">info</span><span class="p">(</span><span class="s">&quot;Received {} scores:&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreCount</span><span class="p">());</span>
            <span class="k">for</span><span class="p">(</span><span class="n">Scenic</span><span class="p">.</span><span class="na">GlobalScore</span> <span class="n">gs</span> <span class="p">:</span> <span class="n">r</span><span class="p">.</span><span class="na">getRep</span><span class="p">().</span><span class="na">getScoreList</span><span class="p">())</span>
            <span class="p">{</span>
              <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;speaker{%s} = {%f}&quot;</span><span class="p">,</span><span class="n">gs</span><span class="p">.</span><span class="na">getClassId</span><span class="p">(),</span><span class="n">gs</span><span class="p">.</span><span class="na">getScore</span><span class="p">()));</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">String</span><span class="p">.</span><span class="na">format</span><span class="p">(</span><span class="s">&quot;Global scorer error: {%s}&quot;</span><span class="p">,</span> <span class="n">r</span><span class="p">.</span><span class="na">getError</span><span class="p">()));</span>
        <span class="p">}</span>
        <span class="n">System</span><span class="p">.</span><span class="na">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">};</span>
</code></pre></div>


-->

<!--
##### TODO: Old Code example for reference:


Following is an example file implementing the OLIVE Java API (scenic-api.jar) to communicate with the scenic server to accomplish several tasks.  This code has been broken up to add comments and documentation that should make it clearer how to perform each task, and what the code is doing at each point. For the full list of possible message options and specifications, please refer to the “API Message Reference” PDF that should have accompanied this document.

A general outline of the contents of this code example:

1.  **General Setup** – Importing libraries, initializing variables and objects
2.  **Establishing Server Connection** – Creating a message pathway between the client implementation and a running OLIVE server
3.  **First Interactions** – Request the available plugins and domains from the server.
4.  **Speech Activity Detection** - Submit audio to the server for scoring from a SAD plugin. Depends on the requestFrameScore function defined in 9.4.
5.  **Speaker Identification and Speaker Diarization and Detection**
    1.  **Enrollment** – Submit audio file(s) for creating/enrolling a speaker model. Uses requestEnrollClass function defined in Appendix section 10.
    2.  **SID Scoring** – Submit audio file(s) for scoring from the list of enrolled speaker models. Relies on requestGlobalScores helper function defined in section 10.
    3.  **SDD Scoring** – Submit audio files for region scoring using an SDD plugin. Can detect speaker changes and multiple participants in the same audio recording. Relies on requestRegionScores helper function defined in section 10.
6.  **Language Identification** – Submit audio to the server for scoring against target language models, using helper functions defined in section 10.
7.  **Topic Identification** – Enroll topics from annotated audio examples, and submit audio for topic ID region scoring.
8.  **Training and Adaption** – Generic instructions for performing training and adaptation for all plugins that support this ability.
9.  **Helper Functions**
    1.  **findPluginDomain** – Find an available domain for a given plugin name.
    2.  **requestPlugins** – Submit a synchronous request to the server for the available plugins, and unpack the resulting message to a list of these available plugins.   Optionally provides code to perform the same task with an asynchronous request.
    3.  **Audio packaging functions** – how to provide audio as a submission to the server
        1.  **packageAudioAsPath** – Submit audio to the OLIVE server using the pathname of a file on disk 
        2.  **packageAudioAsRawBuffer** – Submit audio to the OLIVE server using a buffer of raw samples.
        3.  **packageAudioAsSerializedBuffer** – Submit audio to the OLIVE server as a serialized file.
    4.  **requestFrameScore** – Submit Audio to the OLIVE server for SID scoring.
    5.  **requestEnrollClass** – Submit Audio to the OLIVE server for enrollment, usually for enrolling speakers in a SID plugin.
    6.  **requestGlobalScore** – Submit Audio to the OLIVE server for global scoring.
    7.  **requestStereoGlobalScore** – a special example of submitting Audio to the server that will return a set of scores for each channel in the Audio.
    8.  **requestRegionScoring** – Submit Audio to the OLIVE server for region scoring.
    9.  **processAudioForAdaptation** – Submit Audio to the OLIVE server for preprocessing and later adaptation.
    10. **finalizeSupervisedAdaption** – Finalize preprocessed audio, creating a new domain.
    11. **buildAnnotations** – Helper function for handling annotations for preprocessed audio.

### 1   General Setup

This code is simply importing libraries that will be used to facilitate the connection and communications with the OLIVE server, as well as build and submit messages to and from it.  The com.sri.scenic.api.Scenic package is generated by the protocol buffer compiler based on the definitions of the API outlined within scenic.proto.  The Server and utils.AudioUtil libraries from the com.sri.scenic.api package contain a number of utilities that assist with wrapping and submitting messages to the server and to deal with converting between audio files and raw data buffers, respectively. 

Below that, the class ScenicExampleClient is established to contain the examples that will be covered.  A logger is created within the class, to facilitate providing the user with error and info messages along the way.  

        import com.google.protobuf.ByteString;
        import com.sri.scenic.api.Scenic;
        import com.sri.scenic.api.Server;
        import com.sri.scenic.api.utils.AudioUtil;
        import com.sri.scenic.api.utils.Pair;
        import org.slf4j.Logger;
        import org.slf4j.LoggerFactory;

        import java.nio.file.Path;
        import java.nio.file.Paths;
        import java.util.ArrayList;
        import java.util.HashMap;
        import java.util.List;
        import java.util.Map;

        public class ScenicExampleClient {

            private static Logger log = LoggerFactory.getLogger(ScenicExampleClient.class);
            private static final int TIMEOUT = 10000;

### 2   Establishing Server Connection

The first steps taken within the main is to attempt to connect to an OLIVE server that is already running.  For more information on how to set up and run an OLIVE server, please refer to section 4, Running the OLIVE Server, above.  This example assumes that the OLIVE server is running on the same machine as ScenicExampleClient, but to update this, simply provide the IP address of the remote server instead of “localhost” for serverHostname.  This example also assumes that the default serverRequestPort and serverStatusPort ports are being used (5588 and 5589 respectively), but note that if you provide custom ports when launching the server, those values need to be reflected here. 

The next step is to attempt to connect to the server, using the server.connect and server.getConnected routines, and to report an error if unable to connect before the timeout time has expired. Once a connection has been established, the ScenicExampleClient class is initialized to allow the helper functions defined within/below to be used to facilitate communication with the server.

The server object is used to make all subsequent calls to the OLIVE server.


    public static void main(String[] args) throws Exception {

        // Set these as necessary
        String serverHostname = "localhost";
        int serverRequestPort = 5588;
        int serverStatusPort = 5589;
        String audioFilename = "my_file.wav";

        try {
            Server server = new Server();
            server.connect("scenic-client", serverHostname,
                    serverRequestPort,
                    serverStatusPort,
                    TIMEOUT);    // may need to adjust timeout


            long start_t = System.currentTimeMillis();
            while (!server.getConnected().get() && System.currentTimeMillis() - start_t < TIMEOUT) {
                try {
                    synchronized (server.getConnected()) {
                        server.getConnected().wait(TIMEOUT);
                    }
                } catch (InterruptedException e) {
                    // Keep waiting
                }
            }

            if (!server.getConnected().get()) {
                log.error("Unable to connect to SCENIC server: {}", serverHostname);
                throw new Exception("Unable to connect to server");
            }

            ScenicExampleClient sc = new ScenicExampleClient();

            // Theses examples are all synchronous, but one may also make 
            // asynchronous calls (see requestPlugins() for an example)

### 3   Request Available Plugins

This section of the code covers the one-line call to the requestPlugins helper function (9.2) that returns the list of plugin/domain pairs that the OLIVE server currently has access to. In addition, code is provided that interacts with these Plugin and Domain data objects to extract information like the scoring type trait of the plugin.  For the complete list of possible plugin trait types, please refer to the OLIVE API Message Reference document.

        // Example of requesting current plugins
        List<Pair<Scenic.Plugin, Scenic.Domain>> pluginList =  sc.requestPlugins(server);

        // Check capability of of plugin:
        for(Pair<Scenic.Plugin, Scenic.Domain> pair : pluginList){
            for(Scenic.Trait t : pair.getFirst().getTraitList()) {
                if(t.getType() == Scenic.TraitType.FRAME_SCORER){
                    log.info("Plugin {} supports frame scoring", pair.getFirst().getId());
                            }
                if(t.getType() == Scenic.TraitType.GLOBAL_SCORER){
                    // Supports global scoring (i.e. SID or LID)
                    log.info("Plugin {} supports global scoring", pair.getFirst().getId());
                            }
                if(t.getType() == Scenic.TraitType.REGION_SCORER){
                    // Supports region scoring (i.e. KWS)
                    log.info("Plugin {} supports region scoring", pair.getFirst().getId());
                }
            }
        }

### 4   Speech Activity Detection (SAD)

The following example shows how to use the OLIVE Java Client API to submit audio to an OLIVE server to retrieve frame scores that show the likelihood of speech being present in each audio frame.  There are 3 means of submitting audio to the server (send as a path to the actual file, send as a buffer of raw audio, or send the serialized file), with the second option of sending the raw audio show below. 

        // There are three options for sending audio to the server for frame scoring:

        // 1. Send the path to the audio file to the server (assumes
        // the server and client share a common filesystem)
        //Scenic.Audio audio = packageAudioAsPath(wavFilename, 0, null);

        // 2. Send the raw audio to the server (default behavior)
        Scenic.Audio audio = packageAudioAsRawBuffer(wavFilename, 0, null);

        // 3. Send the serialized file to the server for processing
        //Scenic.Audio audio = packageAudioAsSerializedBuffer(wavFilename, 0, null);


        // SAD is (usually) a frame scorer, so make a frame score request to perform SAD.
        // For simplicity this is made without any options or classID

        // But first create a callback that handles the frame score result from the server:
        Server.ResultCallback<Scenic.FrameScorerRequest, Scenic.FrameScorerResult> rc
                = new Server.ResultCallback<Scenic.FrameScorerRequest, Scenic.FrameScorerResult>() {

            @Override
            public void call(Server.Result<Scenic.FrameScorerRequest, Scenic.FrameScorerResult> r) {

                // do something with the results:
                if(!r.hasError()){
                    for(Scenic.FrameScores fs : r.getRep().getResultList()){
                        // Assume only "speech" results returned (some SAD plugins may recognize
                        // non-speech but that is non-standard)
                        log.info("Received {} frame scores for '{}'", fs.getScoreCount(), fs.getClassId());

                        // Do something else with frame scores...
                    }
                }
                else {
                    log.error("Frame score request failed: {}", r.getError());
                }

            }
        };

        requestFrameScore(server, plugin, domain, audio, rc, false, null, null);


In the above example, SAD is requested using an buffer of audio samples using the provided server connection, plugin and domain.  Once can uncomment one of the other audio packaging methods to send the audio as a pathname or as the serialized file.  See the corresponding audio packaging functions in section 10.3 for more information. 

### 4.1 SAD Adaptation

See section 9 for information on performing SAD adaption.  The adaption process is the same for all plugin types, so there are no special calls for SAD adaption, however, you will need to consult the plugin developer to understand the minimum duration of audio required to perform adaptation. 

### 5   Speaker Identification (SID) and Speaker Diarization and Detection (SDD)

This code provides examples for how to submit speaker identification (SID) enrollment and scoring requests.  Unlike plugins like SAD, which provides scores that represent the likelihood of the presence of speech, or LID, which is currently delivered pre-enrolled with several target languages, you must enroll a speaker model before a SID plugin can provide any scores.  Enrollment is the first task shown below, followed by SID scoring requests.

### 5.1 Basic SID Invocation (Enrollment and Scoring)

The following code walks through a basic SID enrollment and score request submission.  The enrollment format shown here is the same for both SID and SDD plugins.  All that would change between the two are the values of the plugin and domain variables passed to requestEnrollClass.

        // There are three options for sending audio to the server for enrollment and scoring:

            // 1. Send the path to the audio file to the server (assumes
            // the server and client share a common filesystem)
            //Scenic.Audio audio = packageAudioAsPath(wavFilename, 0, null);

            // 2. Send the raw audio to the server (default behavior)
            Scenic.Audio audio = packageAudioAsRawBuffer(enrollWavFilename, 0, null);

            // 3. Send the serialized file to the server for processing
            //Scenic.Audio audio = packageAudioAsSerializedBuffer(wavFilename, 0, null);


            // SID must have at least one enrolled speaker (class) before an enrollment can be made, so create an new enrollment first:

            // But first create a callback that handles the enrollment result from the server:
            Server.ResultCallback<Scenic.ClassModificationRequest, Scenic.ClassModificationResult> enrollmentCallback
                    = new Server.ResultCallback<Scenic.ClassModificationRequest, Scenic.ClassModificationResult>() {

                @Override
                public void call(Server.Result<Scenic.ClassModificationRequest, Scenic.ClassModificationResult> r) {

                    // do something with the results:
                    if(!r.hasError()){
                        // todo handle error
                    }
                    else {
                        log.error("Frame score request failed: {}", r.getError());
                    }

                }
            };

            // We make this a synchronized call, so that we know the speaker is enrolled before we make the score request below
            boolean enrolled = requestEnrollClass(server, plugin, domain, speakerName, audio, enrollmentCallback, false, null);

            if(enrolled){

                // Create a new Audio object from the score wave file.
                Scenic.Audio scoreAudio = packageAudioAsRawBuffer(scoreWaveFilename, 0, null);
                // Also valid, but not used:
                //Scenic.Audio scoreAudio = packageAudioAsPath(scoreWaveFilename, 0, null);
                //Scenic.Audio scoreAudio = packageAudioAsSerializedBuffer(scoreWaveFilename, 0, null);

                // Create a call back to handle the SID
                // Create a callback to handle async results from server
                Server.ResultCallback<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult> scoreCallback = new Server.ResultCallback<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult>() {

                    @Override
                    public void call(Server.Result<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult> r) {

                        // do something with the results:
                        if(!r.hasError()){
                            log.info("Received {} scores:", r.getRep().getScoreCount());
                            for(Scenic.GlobalScore gs : r.getRep().getScoreList()){
                                log.info("\t{} = {}", gs.getClassId(), gs.getScore());
                            }
                        }
                        else{
                            log.error("Global scorer error: {}", r.getError());
                        }

                    }
                };

                // SID is a global scorer, so make a global score request:
                requestGlobalScore(server, plugin, domain, scoreAudio, null, true, scoreCallback, null, null);

            }

        }


### 5.2 SID Scoring Using Stereo Audio

If desired, one can also make a SID call using a stereo audio file, where a result is returned for both of the channels in the audio file.  In the example below it is assumed a speaker has already been enrolled.

        // Assumes one or more speakers are already enrolled

            // Create a new Audio object from the score wave file - BUT be sure to NOT set the channel 
            // number, we want to process all channels of this stereo file
            Scenic.Audio scoreAudio = packageAudioAsRawBuffer(scoreStereoWaveFilename, 0, null);
            // Also valid, but not used:
            //Scenic.Audio scoreAudio = packageAudioAsPath(scoreStereoWaveFilename, 0, null);
            //Scenic.Audio scoreAudio = packageAudioAsSerializedBuffer(scoreStereoWaveFilename, 0, null);
            // Create a call back to handle the SID
            // Create a callback to handle async results from server
            Server.ResultCallback<Scenic.GlobalScorerStereoRequest, Scenic.GlobalScorerStereoResult> scoreCallback = new Server.ResultCallback<Scenic.GlobalScorerStereoRequest, Scenic.GlobalScorerStereoResult>() {

                @Override
                public void call(Server.Result<Scenic.GlobalScorerStereoRequest, Scenic.GlobalScorerStereoResult> r) {

                    // do something with the results:
                    if(!r.hasError()){

                        // Process the scores for EACH channel
                        for(Scenic.GlobalScoreStereo gss : r.getRep().getScoreList()) {
                            log.info("\tChannel {} has {} scores ", gss.getChannel(), gss.getScoreCount());
                            for(Scenic.GlobalScore gs : gss.getScoreList()){
                                log.info("\t\t{} = {}", gs.getClassId(), gs.getScore());
                            }

                        }

                    }
                    else{
                        log.error("Global stereo scorer error: {}", r.getError());
                    }

                }
            };

            // SID is a global scorer, so make a global score request:
            requestStereoGlobalScore(server, plugin, domain, scoreAudio, true, scoreCallback, null, null);



### 5.3 SID Update 

Some SID plugins support an “update” feature that can be used to enhance the plugin’s speaker identification based on recent enrollments, allowing the plugin to be exposed to actual operational conditions.  Plugins that support this feature are said to support the “update” trait, which can be invoked using the code snippet below.  Be cautious in invoking this feature at it may take many minutes to apply an update.

A valid server connection and a SID plugin that support the Update trait are required. You can query the list of traits supported by a plugin via it getTraitList() method.

The update status of the plugin should be checked prior to performing the update as shown in the code example below.

        // First, create two callback handlers.  One to handle the results of the update status request, 
        // and the second to handle the results of an update
        Server.ResultCallback<Scenic.ApplyUpdateRequest, Scenic.ApplyUpdateResult> updateCB
                = new Server.ResultCallback<Scenic.ApplyUpdateRequest, Scenic.ApplyUpdateResult>() {

            @Override
            public void call(Server.Result<Scenic.ApplyUpdateRequest, Scenic.ApplyUpdateResult> r) throws InvalidProtocolBufferException {
                if(!r.hasError()){

                    log.info("Plugin updated: {}", r.getRep().getSuccessful());

                }
                else {
                    log.error("Plugin update request failed: {}", r.getError());
                }

            }
        };


        // This callback will request an update if the plugin reports that an update is possible
        Server.ResultCallback<Scenic.GetUpdateStatusRequest, Scenic.GetUpdateStatusResult> rc
                = new Server.ResultCallback<Scenic.GetUpdateStatusRequest, Scenic.GetUpdateStatusResult>() {

            @Override
            public void call(Server.Result<Scenic.GetUpdateStatusRequest, Scenic.GetUpdateStatusResult> r) 
                    throws InvalidProtocolBufferException {

                // Make sure there was not an error
                if(!r.hasError()){

                    // Pretty print the date - if there is one
                    DateFormat f = new SimpleDateFormat("yyyy-MM-dd 'at' HH:mm:ss z");

                    Scenic.DateTime dt = null;
                    if(r.getRep().hasLastUpdate()) {
                        dt = r.getRep().getLastUpdate();
                        Calendar cal = Calendar.getInstance();
                        cal.set(dt.getYear(), dt.getMonth()-1, dt.getDay(), dt.getHour(), dt.getMin(), dt.getMin());
                        log.info("Update {}, previous update {}", r.getRep().getUpdateReady() ?  "ready": "not ready", f.format(cal.getTime()));
                    }
                    else {
                        log.info("Update {}, NO previous updates", r.getRep().getUpdateReady() ?  "ready" : "not ready");
                    }

                    for(Scenic.Metadata ms : r.getRep().getParamsList()){
                        Server.MetadataWrapper mw = server.deserializeMetadata(ms);
                        log.info("Update: {} = {}, type: {}", ms.getName(), mw.toString(), ms.getType());
                    }

                    if(r.getRep().getUpdateReady()){
                        try {
                            requestApplyUpdate(server, plugin, domain, updateCB, true);
                        } catch (ClientException | IOException | UnsupportedAudioFileException e) {
                            log.error("Could not request ");
                        }
                    }

                }
                else {
                    log.error("SID request failed: {}", r.getError());
                }


            }
        };


        // Now request the update status, and if an update is available then the callback, rc, 
        // will make the request
        requestUpdateStatus(server, plugin, domain, rc, true);

### 5.4   SDD Scoring 

[Speaker Diarization and Detection (SDD)](plugins/sdd.md) plugins are primarily region-scoring plugins that support a variety of different output modes.  The exact supported modes will vary depending on the plugin, but the typically valid modes are described below. To facilitate the understanding of each mode’s output, consider that speech from an audio file is made up of clusters of speakers, and each cluster will have one or more contiguous segment of speech.

##### SPEAKER_DETECTION

The goal of Speaker Detection is to show the most probable speaker model for each segment of the input audio file.  As output, this mode gives one line per segment within the file, along with the top scoring enrolled model for the cluster that segment belongs to, and that cluster's score for the given model. Note that many scores will be repeated in the output file, since each segment in the cluster shares the same score for a given speaker model. This mode is performed by default if no options file with a mode override is given.

##### DIARIZATION

This mode is meant for clustering and labeling of different potential speakers. It does not use enrolled speaker models to attempt to determine who is speaking, but clusters speakers and assigns a placeholder spkr1, spkr2, etc. to each cluster it determines is a new speaker.  While still following the same output format as all other region scoring plugins, the ‘score’ field has been replaced with a placeholder (-100.0) to retain formatting compatibility.

##### SID_EXHAUSTIVE

When using SID Exhaustive, each diarized cluster is scored against each enrolled model. The output is a complete listing for every speech segment of the input audio file, the score from testing every enrolled model against the cluster that the segment belongs to. Many scores will be repeated in the output file, since each segment in the cluster shares the same score.  In this example, Chris and Jimmy are the only enrolled models, and 5 total segments were identified within the file.


For more information on each mode, and example outputs, please consult the [Plugin Reference](plugins.md) page.  

The following example shows how to alter the region scoring request submission to pass the appropriate options to alter the mode of scoring, choosing between the options outlined above.

        // Assumes one or more speakers are already enrolled

            // Create a new Audio object from the score wave file.
            Scenic.Audio scoreAudio = packageAudioAsRawBuffer(scoreWaveFilename, 0, null);
            // Also valid, but not used:
            //Scenic.Audio scoreAudio = packageAudioAsPath(scoreWaveFilename, 0, null);
            //Scenic.Audio scoreAudio = packageAudioAsSerializedBuffer(scoreWaveFilename, 0, null);

            // Create a callback to handle asynchronous results from server
            Server.ResultCallback<Scenic.RegionScorerRequest, Scenic.RegionScorerResult> scoreCallback 
                    = new Server.ResultCallback<Scenic.RegionScorerRequest, Scenic.RegionScorerResult>() {

                @Override
                public void call(Server.Result<Scenic.RegionScorerRequest, Scenic.RegionScorerResult> r) {

                    // do something with the results:
                    if(!r.hasError()){
                        log.info("Received {} regions:", r.getRep().getRegionCount());
                        for(Scenic.RegionScore rs : r.getRep().getRegionList()){
                            log.info("\t{} = {}, From {} to {}", rs.getClassId(), rs.getScore(), rs.getStartT(), rs.getEndT());
                        }
                    }
                    else{
                        log.error("Region scorer error: {}", r.getError());
                    }

                }
            };



            // SDD has optional operational modes.  Submitting the score request with no options will
            // perform Speaker Detection.      
            requestRegionScores(server, plugin, domain, scoreAudio, scoreCallback, true, null, null);

            // Alternately, it is possible to submit an option for the plugin operation MODE.  In this 
            // example, DIARIZATION. 
            Pair<String, String> optionsDiarization = new Pair("mode", "DIARIZATION");
            requestRegionScores(server, plugin, domain, scoreAudio, scoreCallback, true, optionsDiarization, null);

            // And in this case, SID_EXHAUSTIVE
            Pair<String, String> optionsSidExhaustive = new Pair("mode", "SID_EXHAUSTIVE");
            requestRegionScores(server, plugin, domain, scoreAudio, scoreCallback, true, optionsSidExhaustive, null);

            // Some SDD plugins also support basic SID global scoring operations.  If the plugin supports
            // it, that can be done by setting the MODE option to SID, and submitting a global score 
            // request:
            Pair<String, String> optionsSid = new Pair("mode", "SID");
            requestGlobalScore(server, plugin, domain, scoreAudio, true, scoreCallback, optionsSid, null);


### 6   Language Identification (LID)

Submitting scores to the OLIVE Server for LID scoring follows the same structure as the previous example for SID scoring since both SID and LID are Global Scoring plugins. The main consequential difference is going to be the plugin and domain names passed to the requestGlobalScore function below.

        // There are three options for sending audio to the server for enrollment and scoring:

                // Create a new Audio object from the score wave file.
                Scenic.Audio scoreAudio = packageAudioAsRawBuffer(scoreWaveFilename, 0, null);
                // Also valid, but not used:
                //Scenic.Audio scoreAudio = packageAudioAsPath(scoreWaveFilename, 0, null);
                //Scenic.Audio scoreAudio = packageAudioAsSerializedBuffer(scoreWaveFilename, 0, null);

                // Create a call back to handle the LID results
                // Create a callback to handle async results from server
                Server.ResultCallback<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult> scoreCallback = new Server.ResultCallback<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult>() {

                    @Override
                    public void call(Server.Result<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult> r) {

                        // do something with the results:
                        if(!r.hasError()){
                            log.info("Received {} scores:", r.getRep().getScoreCount());
                            for(Scenic.GlobalScore gs : r.getRep().getScoreList()){
                                log.info("\t{} = {}", gs.getClassId(), gs.getScore());
                            }
                        }
                        else{
                            log.error("Global scorer error: {}", r.getError());
                        }

                    }
                };

            // LID is a global scorer, so make a global score request:
            requestGlobalScore(server, plugin, domain, scoreAudio, true, scoreCallback, null, null);


### 6.1 LID Language Enrollment

Some LID plugins support an enrollment option.  This option lets the user extend the recognized languages by exposing the system to new, labeled data to enroll a new language, or augment an existing language, without generating an entirely new domain, which would happen if the existing language classes were augmented with additional data via training/adaptation. 

        // First prepare the audio for enrollment 
        Scenic.Audio audio = packageAudioAsRawBuffer(enrollWavFilename, 0, null);
        // Other ways to package audio: 
        // Scenic.Audio audio = packageAudioAsPath(wavFilename, 0, null);
        //Scenic.Audio audio = packageAudioAsSerializedBuffer(wavFilename, 0, null);
        // But first create a callback that handles the enrollment result from the server:
        Server.ResultCallback<Scenic.ClassModificationRequest, Scenic.ClassModificationResult> enrollmentCallback
                = new Server.ResultCallback<Scenic.ClassModificationRequest, Scenic.ClassModificationResult>() {

            @Override
            public void call(Server.Result<Scenic.ClassModificationRequest, Scenic.ClassModificationResult> r) {

                // do something with the results:
                if(!r.hasError()){
                    // handle result
                }
                else {
                    log.error(“enrollment request failed: {}”, r.getError());
                }

            }
        };

        // We make this a sync call, so that we know the language is enrolled before we make the score request below
        boolean enrolled = requestEnrollClass(server, plugin, domain, classIDName, audio, enrollmentCallback, false, null);

### 6.2 LID Update

Some LID plugins support an “update” feature that can be used to enhance the plugin’s language identification based on recent enrollments.  Plugins that support this feature are said to support the “update” trait, which can be invoked using the code snippet below.  Be cautious in invoking this feature at it may take many minutes to apply an update.

A valid server connection and a LID plugin that support the Update trait are required. You can query the list of traits supported by a plugin via it getTraitList() method.

For a code example for submitting an update request to a LID plugin, the exact same code as provided in 5.3 SID Update can be used, simply by ensuring that the appropriate LID plugin is populated into the plugin and domain variables used.

### 7   Topic Detection (TPD)

Topic Identification is a region-scoring plugin that detects and labels regions of speech where a target topic from a set of enrolled topics-of-interest is being discussed.  Each domain of a topic identification plugin is language-specific, and can only detect topics in its known language, so care should be used when choosing which domain to submit audio to.  Topics are meant to be user-enrolled, through a process that is similar to speaker enrollment in a SID plugin. The example below mirrors the SID example above, and starts out by showing a topic enrollment, followed by a region scoring request.

        // First, create submit a topic as an enrollment
        // 1. Send the raw audio to the server (default behavior) - NOTE that we specify a region

        List<RegionWord> regions = new ArrayList<>();
        regions.add(new RegionWord(0.500, 2.500));  // NOTE to add regions in seconds

        // Include regions when the audio is packaged in a protobuf message:
        Scenic.Audio audio = packageAudioAsRawBuffer(enrollWavFilename, 0, regions);


        // Valid but not used here:
        //Scenic.Audio audio = packageAudioAsSerializedBuffer(wavFilename, 0, regions);
        //Scenic.Audio audio = packageAudioAsPath(wavFilename, 0, regions);

        // TID must have at least one enrolled speaker (class) before an enrollment can be made, so create an new enrollment first:

        // But first create a callback that handles the enrollment result from the server:
        Server.ResultCallback<Scenic.ClassModificationRequest, Scenic.ClassModificationResult> enrollmentCallback
                = new Server.ResultCallback<Scenic.ClassModificationRequest, Scenic.ClassModificationResult>() {

            @Override
            public void call(Server.Result<Scenic.ClassModificationRequest, Scenic.ClassModificationResult> r) {

                // do something with the results:
                if(!r.hasError()){
                    // todo handle error
                }
                else {
                    log.error("request failed: {}", r.getError());
                }

            }
        };

        // We make this a sync call, so that we know the topic is enrolled before we make the score request below
        boolean enrolled = requestEnrollClass(server, plugin, domain, topicName, audio, enrollmentCallback, false, null);
        if(!enrolled){
            // need to handle this error...
            log.error("Enrollment failed");
        }

        // BUT there are other enrollment options, for example you may want to enroll a submission as a "negative" example
        Scenic.Audio negAudio = packageAudioAsRawBuffer(enrollWavFilename, 0, null);  // not specifying regions, since the target topic is not in the file
        // We reuse the above callback for to enroll this "negative" topic:

        List<Pair<String, String>> options = new ArrayList<>();
        options.add(new Pair<>("isNegative", "True"));

        enrolled = requestEnrollClass(server, plugin, domain, topicName, negAudio, enrollmentCallback, false, options);
        // if true, a negative example was enrolled


        if(enrolled){

            // Create a new Audio object from the score wave file.
            Scenic.Audio scoreAudio = packageAudioAsRawBuffer(scoreWaveFilename, 0, null);
            // Also valid, but not used:
            //Scenic.Audio scoreAudio = packageAudioAsPath(scoreWaveFilename, 0, null);
            //Scenic.Audio scoreAudio = packageAudioAsSerializedBuffer(scoreWaveFilename, 0, null);

            // Create a callback to handle async results from server
            Server.ResultCallback<Scenic.RegionScorerRequest, Scenic.RegionScorerResult> scoreCallback
                    = new Server.ResultCallback<Scenic.RegionScorerRequest, Scenic.RegionScorerResult>() {

                @Override
                public void call(Server.Result<Scenic.RegionScorerRequest, Scenic.RegionScorerResult> r) {

                    // do something with the results:
                    if(!r.hasError()){
                        log.info("Received {} regions:", r.getRep().getRegionCount());
                        for(Scenic.RegionScore rs : r.getRep().getRegionList()){
                            log.info("\t{} = {}, From {} to {}", rs.getClassId(), rs.getScore(), rs.getStartT(), rs.getEndT());
                        }
                    }
                    else{
                        log.error("Region scorer error: {}", r.getError());
                    }

                }
            };


            // Options that can be added (commented out) to the request - consult the Plugin reference guide for options supported by your plugin

            options.clear();
            /*options.add(new Pair<>("max_segment_length_sec", "0.4"));
            options.add(new Pair<>("sad_filter_length", "40"));
            options.add(new Pair<>("sad_interpolate", "2"));
            options.add(new Pair<>("sad_minimum_duration", "0.4"));
            options.add(new Pair<>("sad_speech_llr_threshold", "1.5"));
            options.add(new Pair<>("sad_speech_padding", "0.5"));
            options.add(new Pair<>("use_sad", "True"));*/
            // These are region scoring only parameters
            /*options.add(new Pair<>("padding", "5"));
            options.add(new Pair<>("threshold", "-2"));
            options.add(new Pair<>("td_thr_shift", "-0.5"));*/

            // TPD is a region scorer, so make a region score request:
            requestRegionScores(server, plugin, domain, scoreAudio, scoreCallback, true, options, null);

        }


### 8   Keyword Spotting (KWS)

Keyword spotting is a region-scoring plugin that detects and labels regions of speech corresponding to the location of detected keywords of interest.  Like Topic Identification, keyword spotting domains are language-dependent, and can only detect keywords in its known language, and that are in-vocabulary.  Because of this, care should be used when choosing which domain to submit audio to.  Keyword spotting plugins are based on automatic speech recognition (ASR) technology, so keywords are solely text-based.  As such, they are not “enrolled” like a query-by-example word or phrase, or a topic in TID.  Instead, they are passed to the requestRegionScores function as options

The example below mirrors the previous scoring examples, showing audio packaging and submission for region scoring for KWS, passing a set of three keywords: watermelon, pumpkin pie, and mountaintop.

        // There are three options for sending audio to the server for enrollment and scoring:

                // Create a new Audio object from the score wave file.
                Scenic.Audio scoreAudio = packageAudioAsRawBuffer(scoreWaveFilename, 0, null);
                // Also valid, but not used:
                //Scenic.Audio scoreAudio = packageAudioAsPath(scoreWaveFilename, 0, null);
                //Scenic.Audio scoreAudio = packageAudioAsSerializedBuffer(scoreWaveFilename, 0, null);

                // Create a call back to handle the LID results
                // Create a callback to handle async results from server
                Server.ResultCallback<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult> scoreCallback = new Server.ResultCallback<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult>() {

                    @Override
                    public void call(Server.Result<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult> r) {

                        // do something with the results:
                        if(!r.hasError()){
                            log.info("Received {} scores:", r.getRep().getScoreCount());
                            for(Scenic.GlobalScore gs : r.getRep().getScoreList()){
                                log.info("\t{} = {}", gs.getClassId(), gs.getScore());
                            }
                        }
                        else{
                            log.error("Global scorer error: {}", r.getError());
                        }

                    }
                };

            // KWS is a region scorer, so make a region score request.
            // Pass the options string to submit keywords to the plugin.
            List<String> keywordClasses = Arrays.asList("watermelon", "pumpkin pie", "mountaintop"); 
            requestRegionScores(server, plugin, domain, scoreAudio, scoreCallback, true, null, keywordClasses);


### 9   Training and Adaptation

Some plugins support training and/or adaptation, these plugins implement the Learning Trait or  one of its derived types such as SupervisedAdapter which is covered below.  Both training and adaption result in the creation of a new domain and require preprocessing a set of Audio submissions, followed by a finalize step that creates the new domain from the preprocessed audio.   This process is the same for all plugins, however plugins vary in the recommended duration of audio needed to complete the adaptation process.

### 9.1 Supervised Adaptation

To perform adaptation one will need to build a list of files to use for adaptation, associating each of those files with a class ID.  These audio files are first preprocessed by making the call to preprocessAudioForAdaptation() below.  After all files have been preprocessed, the adaptation can be finalized by calling finalizeSupervisedAdaptation().  Be prepared that Adaptation can be a slow process, taking half an hour or more, depending on hardware used and the amount of audio submitted for adaptation.    

        // Pseudo code shown creating the adaptList: 
        Map<String, Scenic.Audio> adaptList = new HashMap<>();
        // Not shown here, but will need to add code that will create one or 
        // more audio files plus a class ID to the adaptList like this:

        adaptList.put(“English”, packageAudioAsPath(“enlish_train.wav”, 0, null));

        // TODO: consult with plugin developer to determine the min duration of audio for adaptation 


        Map<String, List<String>> annotations  = new HashMap<>();
        String adaptID = UUID.randomUUID().toString();

        int numPreprocessed = 0;
        for (String classID : adaptList.keySet()){

            //Server.ResultCallback<Scenic.PreprocessAudioAdaptRequest, Scenic.PreprocessAudioAdaptResult> cb = r -> log.info(“Audio preprocessing done”);

            // Submit audio for preprocessing, each audio successfully preprocessed is used to build up the annotations that are submitted below when we finalize
            if (preprocessAudioForAdaptation(server, plugin, domain, classID, adaptID, adaptList.get(classID), annotations )){
                numPreprocessed++;
            }
        }

        // For this example, we go ahead and finalize if some of our audio was preprocessed,
        // but one may want to skip this step if one or more files could not be processed
        if (numPreprocessed>0){

            Server.ResultCallback<Scenic.SupervisedAdaptationRequest, Scenic.SupervisedAdaptationResult> rc = r -> log.info(“New Domain Adapted”);

            finalizeSupervisedAdaptation(server, plugin, domain, adaptID, newDomainName, rc, annotations);


        }


### 10  Global Comparer (CMP)

A Global Comparer plugin combines multiple audio characterization features into a single plugin, that is used to analyze two audio inputs.  The result is a dictionary of name/value characterizations of the two files and a human readable (PDF) report that summarizes the comparison results in an easy to read format.  To perform audio comparison, the plugin must support the GlobalComparer trait.  Here is an example of making a comparison request:

        // Assumes these are set: 
        //Server server 
        //Scenic.Plugin  plugin,
        //Scenic.Domain domain
        //String audio_file_one 
        //String audio_file_two

        // Create new Audio objects from the two input files to comapre
        Scenic.Audio audio_one = packageAudioAsRawBuffer(audio_file_one, 0, null);
        Scenic.Audio audio_two = packageAudioAsRawBuffer(audio_file_two, 0, null);

        // Also valid, but not used:
        //Scenic.Audio audio = packageAudioAsPath(audio_file_one, 0, null);
        //Scenic.Audio audio = packageAudioAsSerializedBuffer(audio_file_two, 0, null);

        // Create a call back to handle the results of the audio comparison
        Server.ResultCallback<Scenic.GlobalComparerRequest, Scenic.GlobalComparerResult> rc = new Server.ResultCallback<Scenic.GlobalComparerRequest, Scenic.GlobalComparerResult>() {

            @Override
            public void call(Server.Result<Scenic.GlobalComparerRequest, Scenic.GlobalComparerResult> r) {

                // do something with the results:
                if(!r.hasError()){

                    // The real output of the compare result is the PDF report, but there is is the dictionary of results
                    // that can be evaluated if desired:
                    log.info("Comparision dictionary contains {} results", r.getRep().getResultsCount());


                    // The results can be extracted like this:
                    Map<String, Server.MetadataWrapper> results = new HashMap<>();
                    Scenic.GlobalComparerResult result = r.getRep();
                    for(Scenic.Metadata meta : result.getResultsList()){

                        try {
                            Server.MetadataWrapper mw = server.deserializeMetadata(meta);
                            log.info("Comapre metadata result: {} = {}", meta.getName(), mw.toString());
                            results.put(meta.getName(), mw);
                        } catch (InvalidProtocolBufferException e) {
                            log.error("Unsupported metadata type: {}", meta.getType());
                        }
                    }


                    // Assume there will be only one report
                    if(result.getReportCount() > 0 ) {

                        Scenic.GlobalComparerReport report = result.getReport(0);

                        // Confirm the report is a PDF (so far only PDF reports are generated)
                        if (report.getType() == Scenic.ReportType.PDF) {
                            String rptName = String.format("%s-%s.pdf", audio_file_one, audio_file_two);
                            // Save this file in the working directory for this example:
                            Path path = Paths.get("./", rptName);

                            try {
                                // Save the buffer as a PDF:
                                InputStream buffer = new ByteArrayInputStream(report.getReportData().toByteArray());

                                Files.copy(buffer, path, StandardCopyOption.REPLACE_EXISTING);

                            } catch (Exception e) {
                                log.error("Failed to save comparison report because: {}", e.getMessage());
                            }

                        }
                    }


                }
                else{
                    log.error("Global comparison failed with error: {}", r.getError());
                }

            }
        };

        Scenic.GlobalComparerRequest.Builder req = Scenic.GlobalComparerRequest.newBuilder()
                .setPlugin(plugin.getId())
                .setDomain(domain.getId())
                .setAudioOne(audio_one)
                .setAudioTwo(audio_two);


        // If you have options to pass to the plugin

        List<Pair<String, String>> option = new ArrayList<>();
        // for example: option.add(new Pair<>("foo", "bar"));
        for (Pair<String, String> p : option){
            req.addOption(Scenic.OptionValue.newBuilder().setName(p.getFirst()).setValue(p.getSecond()));
        }


        // Send the request to the server (callback above handles the result)
        server.enqueueRequest(req.build(), rc);






### 11  Helper Functions

These functions perform the actual bulk of the work described above.  The code above serves as an example for how simple the actual interactions with the OLIVE API code can be once a function call has been established to perform each task, while the functions defined below contain the implementation details for accomplishing each of those tasks.

### 11.1    findPluginDomain

This function simply takes a plugin name, and the list of all valid plugin/domain pairs supported by the server (reported by the requestPlugins function), and returns a Pair with the requested plugin and the first valid domain of that plugin.  This allows the client to programmatically build a list of available plugins and domains, as well as query and update this list in real time.

        /**
         * Helper function for finding a plugin/domain based on the name of the plugin
         * 
         * @param pluginName the name of the plugin
         *                   
         * @param pluginList all plugins
         *                   
         * @return a plugin and domain
         */
        public Pair<Scenic.Plugin, Scenic.Domain> findPluginDomain(String pluginName, List<Pair<Scenic.Plugin, Scenic.Domain>> pluginList ){

            Scenic.Plugin plugin = null;
            Scenic.Domain domain = null;
            for(Pair<Scenic.Plugin, Scenic.Domain> p : pluginList){
                // Use the first domain found for the requested plugin
                if(p.getFirst().getId().equals(pluginName)){
                    plugin= p.getFirst();
                    domain = p.getSecond();
                    break;
                }
            }

            if(plugin != null){
                return new Pair<>(plugin, domain);
            }

            return null;
        }

### 11.2    requestPlugins

This function takes an open connection to an OLIVE Server, builds a message requesting information from the server about the plugins it has access to, and returns a list of valid plugin/domain pairs that are available for additional requests.  The main function as defined outlines how this can be done with a synchronous request, as all of the scoring request examples are; but there is an additional example shown in the gray commented-out code providing the code to send the same request asynchronously.

Once the server has replied, a loop is provided to demonstrate how to unpack the reply message to extract the desired information.

        Public List<Pair<Scenic.Plugin, Scenic.Domain>> requestPlugins(Server server) throws ClientException {


            List<Pair<Scenic.Plugin, Scenic.Domain>> pluginList = new ArrayList<>();
            Server.Result<Scenic.PluginDirectoryRequest, Scenic.PluginDirectoryResult> result =
                    server.synchRequest(Scenic.PluginDirectoryRequest.newBuilder().build());

            // You could also call this asynchronously
            /*Server.ResultCallback<Scenic.PluginDirectoryRequest, Scenic.PluginDirectoryResult> rc = new Server.ResultCallback<Scenic.PluginDirectoryRequest, Scenic.PluginDirectoryResult>() {
                @Override
                public void call(Server.Result<Scenic.PluginDirectoryRequest, Scenic.PluginDirectoryResult> r) {
                    // do something with the results:
                    if(!r.hasError()){
                        for(Scenic.Plugin p : r.getRep().getPluginsList()){
                            log.info(“{}: {}”, p.getId(), p.getDesc());
                            for(Scenic.Domain d : p.getDomainList()){
                                log.debug(“\t {}: {}”, d.getId(), d.getDesc());
                            }
                        }
                    }

                }
            };

            server.enqueueRequest(Scenic.PluginDirectoryRequest.newBuilder().build(), rc);
            */;


            for(Scenic.Plugin p : result.getRep().getPluginsList()){
                log.info(“{}: {}”, p.getId(), p.getDesc());
                for(Scenic.Domain d : p.getDomainList()){
                    log.debug("“\t {}: {}”, d.getId(), d.getDesc());
                    pluginList.add(new Pair<Scenic.Plugin, Scenic.Domain>(p, d));
                }
            }
            return  pluginList;
        }


### 11.3    Audio packaging functions

Audio may be submitted to the server either as:
- The path to the audio file (assumes the server and client share the same filesystem).
- As a buffer of raw audio samples (assumes the samples are 16-bit PCM data at 8000 Hz).
- As a serialized audio file, where the file is read of disk and sent entirely to the server as data (audio header and all).

The three functions below, packageAudioAsPath, packageAudioAsRawBuffer, and packageAudioAsSerializedBuffer demonstrate how to create an Audio protobuf that can be used as an OLIVE submission.  

Each of the functions accept a channelNumber and list of RegionWords.  Both of these parameters are optional.  

By default audio is treated as mono by the server, but if a channel number greater than 0 is specified, the channel field is set for the Audio message.  This tells the server to process this channel and not treat the audio submission as mono.  

Optionally, a set of region annotations (start/end regions in seconds) can associated with the Audio.  When regions are specified, this is intended to tell the plugin to process these sub regions with in the file.  Support for region annotations varies by plugin, so setting these is no guarantee they will be handled by the plugin.  Please consult with SRI or refer to the Plugin Reference Guide to verify that the plugin can handle region annotations before proceeding.

### 11.3.1  Send the Filesystem Path as the Audio: packageAudioAsPath

The packageAudioAsPath function creates an Audio object that includes the path to the audio.  This should only be used when both the client and server share a filesystem, as this path must accessible to the server.  

Optionally the channel number and annotation regions may be specified as described above if the audio should NOT be treated as mono or one or more regions need to be passed to the server.

        Public Scenic.Audio packageAudioAsPath(String wavFileName,  int channelNumber, List<RegionWord> regions){

            Scenic.Audio.Builder audioBuilder = Scenic.Audio.newBuilder().setPath(wavFileName);

            // For multi-channel (stereo) audio we have the option of specifying the channel 
            // to process, otherwise the file is treated as mono (if stereo)
            if (channelNumber > 0) {
                audioBuilder.setChannel(channelNumber);
            }


            // Add optional region annotations
            if (null != regions) {
                for (RegionWord word : regions) {


        audioBuilder.addRegions(Scenic.AnnotationRegion.newBuilder().setStartT(word.start).setEndT(word.end));
                }
            }



            return audioBuilder.build();

        }

### 11.3.2  Send Audio as a Buffer of Raw Samples: packageAudioAsRawBuffer

The packageAudioAsRawBuffer function starts by opening an AudioInputStream for the specified audio file. This stream is used to read in the raw samples as a byte array an then fill in the header/metadata (channel, sample rate, length, and bit depth) for the AudioBuffer.  This AudioBuffer is then populated with the byte[] samples data that was provided as input. This step is necessary because the message requires that the data be stored in a protobuf byte array, rather than a Java byte array.  

Finally, a Scenic.Audio object is created with AudioBuffer added as AudioSamples field. 

Note that when submitting audio to the server through a buffer like this, the data must be comprised of 16-bit PCM audio samples and the bit depth is set to “BIT_DEPTH_16”.

Note that submitting a request in this manner has some requirements. The byte array of audio samples must 16-bit PCM data in this example, but this can be updated to support other bitrates if this information is passed into the helper function instead of using the constant value of “BIT_DEPTH_16”. Many audio processing codebases will automatically convert to this format when opening audio files and loading them into memory. However, this allows audio to be submitted for scoring that isn’t stored locally on the machine hosting the OLIVE Server.


        Public Scenic.Audio packageAudioAsRawBuffer(String wavFileName, int channelNumber, List<RegionWord> regions) throws IOException, UnsupportedAudioFileException {


            AudioInputStream ais = AudioSystem.getAudioInputStream(Paths.get(wavFileName).toFile());

            byte[] samples = convertWav2Buffer(ais);

            Scenic.AudioBuffer.Builder  abuff = Scenic.AudioBuffer.newBuilder()
                    //.setEncoding(Scenic.AudioEncodingType.PCM16)  Do not set – for future use
                    .setChannels(ais.getFormat().getChannels())
                    .setRate((int) ais.getFormat().getSampleRate())
                    .setSamples(samples.length)
                    .setBitDepth(Scenic.AudioBitDepth.BIT_DEPTH_16);

            abuff.setData(ByteString.copyFrom(samples));

            Scenic.Audio.Builder audioBuilder = Scenic.Audio.newBuilder();

            // For multi-channel (stereo) audio we have the option of specifying 
            // the channel to process, otherwise the file is treated as mono (if stereo)
            if (channelNumber > 0) {
                audioBuilder.setAudioSamples(abuff.build()).setChannel(channelNumber);
            }
            else {
                // process as mono
                audioBuilder.setAudioSamples(abuff.build());
            }

            // Add optional region annotations
            if (null != regions) {
                for (RegionWord word : regions) {
                    audioBuilder.addRegions(Scenic.AnnotationRegion.newBuilder()
                .setStartT(word.start).setEndT(word.end));
                }
            }

            return audioBuilder.build();


        }


### 11.3.3  Send Audio as a Serialized File: packageAudioAsSerializedBuffer

This function again represents a small but important deviation from the previous audio packaging functions.  This method is again passed the path to an audio file as input, but in this case, the function loads the entire audio file (header included) into a data object, leaving it completely intact and without doing any sort of decoding.  This allows the file to be passed in its entirety to the OLIVE server, allowing the server to read the header and do any decoding in case any uncommon audio formats or compressed audio types are used. Note that this feature currently only supports RIFF wav headered files, of certain formats, including 8-bit a-law, 8-bit mu-law, 16-bit PCM, and others.  If you have a specific audio file format you wish to use, please consult with SRI to verify compatibility. 

This feature allows the server to process the file with full access to the information contained in the file’s header, and converting the data to a processable format if necessary.  This allows some non-standard audio formats (such as 8-bit a-law or 8-bit μ-law).  This may be useful if the client does not have the capability to open and decode these files, and the files are not stored locally on the OLIVE Server machine.

As discussed above, the channel number may be specified if the audio should not be handled as mono.  One may also add one or more annotation regions, if needed by the plugin.


        Public Scenic.Audio packageAudioAsSerializedBuffer(String wavFileName, int channelNumber, List<RegionWord> regions) throws IOException {


            // NOTE: the audio format is set to zeros or some default value when serializing an
            // audio file since these fields are required (but ignored by the server for serializing 
            // audio)
            byte[] serialized = Files.readAllBytes(Paths.get(wavFileName));
            Scenic.AudioBuffer.Builder abuff = Scenic.AudioBuffer.newBuilder()
                    .setSerializedFile(true)
                    //.setEncoding()  // Ignored for now – this is a future feature
                    .setChannels(0)
                    .setRate(0)
                    .setSamples(0)
                    .setBitDepth(Scenic.AudioBitDepth.BIT_DEPTH_16);  // Again an
            abuff.setData(ByteString.copyFrom(serialized));

            Scenic.Audio.Builder audioBuilder = Scenic.Audio.newBuilder();

            // For multi-channel (stereo) audio we have the option of specifying the channel 
            // to process, otherwise the file is treated as mono (if stereo)
            if (channelNumber > 0) {
                audioBuilder.setAudioSamples(abuff.build()).setChannel(channelNumber);
            }
            else {
                // process as mono
                audioBuilder.setAudioSamples(abuff.build());
            }

            // Add optional region annotations
            if (null != regions) {
                for (RegionWord word : regions) {
                    audioBuilder.addRegions(Scenic.AnnotationRegion.newBuilder()
                            .setStartT(word.start).setEndT(word.end));
                }
            }

            return audioBuilder.build();


        }


### 11.4    requestFrameScore

This function is used to make a frame score request, which returns a score for each frame (100 frames per second) of audio submitted.  Frame scores are generally used for SAD, with a list of scores returned for the class ID “speech”.  In the code example below, the Audio object is assumed to be created in one of the three ways previously described (pathname, raw samples, or serialized file).  

In addition to the audio object, this function takes a connection to the server and a valid plugin and domain (the plugin and domain were acquired via the call to requestPlugins()).

This example also illustrates making asynchronous and synchronous requests, where async requests return immediately after submitting the request to the server and sync requests wait for a response to be received from the server.  When the async flag is set to true, the callback, rc, is invoked by the server object when the FrameScoreResult is received, otherwise it is explicitly called when the server’s synchRequest() method returns.  

        Public static boolean requestFrameScore(Server server,
                                                Scenic.Plugin  plugin,
                                                Scenic.Domain domain,
                                                Scenic.Audio audio,
                                                Server.ResultCallback<Scenic.FrameScorerRequest,      Scenic.FrameScorerResult> rc,
                                                boolean async,
                                                List<Pair<String, String>> options,
                                                List<String> classIDs) throws ClientException, IOException, UnsupportedAudioFileException {


            Scenic.FrameScorerRequest.Builder req = Scenic.FrameScorerRequest.newBuilder()
                    .setAudio(audio)
                    .setPlugin(plugin.getId())
                    .setDomain(domain.getId());

            // Process plugin options (if any)
            if(null != options) {
                for (Pair<String, String> p : options) {    
        req.addOption(Scenic.OptionValue.newBuilder().setName(
                p.getFirst()).setValue(p.getSecond()));
                }
            }

            // And add any class IDS  - if any
            if(null != classIDs && classIDs.size() >0)
                req.addAllClassId(classIDs);

            //
            if (async) {
                server.enqueueRequest(req.build(), rc);
            }
            else {

                Server.Result<Scenic.FrameScorerRequest, Scenic.FrameScorerResult> result = server.synchRequest(req.build());
                rc.call(result);
            }


            return true;
        }



### 11.5    requestEnrollClass

The requestEnrollClass method is normally used to enroll new speakers for a SID plugin.   It requires an Audio object (created via one of the three audio packaging techniques), a plugin, domain and the name of the class to enroll.  Normally the class is the name of a speaker to enroll for a SID plugin. The callback can called asynchronously when the server receives the ClassModificationResult message from the server if the async flag is set to true, otherwise this function will block until the server receives the message, invoking the callback when a message is received.

        /**
         * Make a class enrollment request
         * @param server the server object
         * @param plugin the plugin
         * @param  domain the domain to use for enrollment
         * @param id the class id (speaker) to enroll
         * @param rc the call back function
         * @param async true if this call should be asynchronous
         * @param options zero or more optional parameters for the plugin
         * @return true if submitted
         *
         * @throws ClientException
         */
        public static boolean requestEnrollClass(Server server,
                                                 Scenic.Plugin plugin,
                                                 Scenic.Domain domain,
                                                 String id,
                                                 Scenic.Audio audio,
                                                 Server.ResultCallback<Scenic.ClassModificationRequest, Scenic.ClassModificationResult> rc,
                                                 boolean async,
                                                 List<Pair<String, String>> options) throws ClientException {


            try {
                // NOTE: not shown here, but one could submit multiple audio submission for the same class id:
                Scenic.ClassModificationRequest.Builder req = Scenic.ClassModificationRequest.newBuilder()
                        .setClassId(id)
                        .addAddition(audio)
                        .setPlugin(plugin.getId())
                        .setDomain(domain.getId());

                // Add options, if there are options.  Supported options vary by plugin
                if (null != options) {
                    for (Pair<String, String> p : options) { 
        req.addOption(Scenic.OptionValue.newBuilder().setName(p.getFirst()).
        setValue(p.getSecond()));
                    }
                }

                // Either make a sync or async request
                if(async){
                    server.enqueueRequest(req.build(), rc);
                }
                else {
                    Server.Result<Scenic.ClassModificationRequest, Scenic.ClassModificationResult> result = server.synchRequest(req.build());
                    rc.call(result);
                }

            } catch (Exception e) {
                log.error(“Enrollment failed because: {}”, e);
                return  false;
            }

            return true;

        }



### 11.6    requestGlobalScore

This function is used to make a GlobalScorer request, where a set of scores is returned for the entire audio submission.  There should be one score returned for each class supported by the plugin/domain.  LID and SID are normally GlobalScorers.  For SID, scores for each enrolled speaker is returned, while LID returns a score for each supported language. 

As with previous score request a valid connection to the server, plugin, and domain are required.  The result can also be handled asynchronously.

        /**
         * Make a global score request
         *
         * @param server the OLIVE server
         * @param plugin the requested plugin to provide the score
         * @param domain the requested domain to provide the score
         * @param audio the audio submission
         * @param async true if this function should not block, waiting for a response from the server
         * @param rc the callback
         * @param options zero or more options to pass to the plugin
         * @param classIDs zero or more class IDs to pass to the plugin to filter the scores
         * @return
         * @throws ClientException
         * @throws IOException
         * @throws UnsupportedAudioFileException
         */
        public static boolean requestGlobalScore(Server server,
                                                 Scenic.Plugin  plugin,
                                                 Scenic.Domain domain,
                                                 Scenic.Audio audio,
                                                 Scenic.AudioVector vector,
                                                 boolean async,
                                                 Server.ResultCallback<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult> rc,
                                                 List<Pair<String, String>> options,
                                                 List<String> classIDs) throws ClientException, IOException, UnsupportedAudioFileException {



            Scenic.GlobalScorerRequest.Builder req = Scenic.GlobalScorerRequest.newBuilder()
                    .setPlugin(plugin.getId())
                    .setDomain(domain.getId());

            // Add any options, if there are any
            if(null != options) {
                for (Pair<String, String> p : options){
        req.addOption(Scenic.OptionValue.newBuilder().setName(
        p.getFirst()).setValue(p.getSecond()));
                }
            }

            // And add any class IDS  - if any
            if(null != classIDs && classIDs.size() >0)
                req.addAllClassId(classIDs);

            if(null != vector){
                req.setVector(vector);
            }
            else {
                req.setAudio(audio);
            }


            if (async) {
                server.enqueueRequest(req.build(), rc);
            }
            else {

                Server.Result<Scenic.GlobalScorerRequest, Scenic.GlobalScorerResult> result = server.synchRequest(req.build());
                rc.call(result);
            }


            return true;

        }

### 11.7    requestStereoGlobalScore

This is basically the same call as requestGlobalScore, except if the submitted audio is stereo  then two score results are returned from the server.  The code example below shows to make and process this request.

        /**
         * Make a global score request
         * 
         * @param server the OLIVE server
         * @param plugin the requested plugin to provide the score
         * @param domain the requested domain to provide the score
         * @param audio the audio submission
         * @param async true if this function should not block, waiting for a response from the server
         * @param rc the callback 
         * @param options zero or more options to pass to the plugin
         * @param classIDs zeror or more class IDs to pass to the plugin to filter the scores
         * @return
         * @throws ClientException
         * @throws IOException
         * @throws UnsupportedAudioFileException
         */
        public static boolean requestStereoGlobalScore(Server server,
                                                 Scenic.Plugin  plugin,
                                                 Scenic.Domain domain,
                                                 Scenic.Audio audio,
                                                 boolean async,
                                                 Server.ResultCallback<Scenic.GlobalScorerStereoRequest, Scenic.GlobalScorerStereoResult> rc,
                                                 List<Pair<String, String>> options,
                                                 List<String> classIDs) throws ClientException, IOException, UnsupportedAudioFileException {



            Scenic.GlobalScorerStereoRequest.Builder req = Scenic.GlobalScorerStereoRequest.newBuilder()
                    .setPlugin(plugin.getId())
                    .setDomain(domain.getId())
                    .setAudio(audio);


            // Add any options, if there are any
            if(null != options) {
                for (Pair<String, String> p : options){ 
        req.addOption(Scenic.OptionValue.newBuilder().setName(
        p.getFirst()).setValue(p.getSecond()));
                }
            }

            // And add any class IDS  - if any
            if(null != classIDs && classIDs.size() >0)
                req.addAllClassId(classIDs);


            if (async) {
                server.enqueueRequest(req.build(), rc);
            }
            else {

                Server.Result<Scenic.GlobalScorerStereoRequest, Scenic.GlobalScorerStereoResult> result = server.synchRequest(req.build());
                rc.call(result);
            }


            return true;

        }



### 11.8    requestRegionScoring

This function is used to make a region scoring request on the submitted audio.  A region score will contain an arbitrary number of start/end regions and class scores.  KWS and QbE are usually region scoring plugins, as are most of the modes of SDD.  

As with previous score request a valid connection to the server, plugin, and domain are required.  The result can also be handled asynchronously.

        /**
         * Used to make a region score request.
         *
         * @param server the connection to the OLIVE server
         *
         * @param plugin the plugin to use for scoring
         * @param domain the domain to use  for scoring
         * @param audio the audio to submit for scoring
         * @param rc a callback to be invoked when the score result is returned from the server.
         * @param async true, if you want the server to call back
         * @param options zero or more optional name/value properties to send to the plugin
         * @param classIDs zero or more class IDs (languages or speakers) to send to the plugin to limit results
         * @return
         * @throws ClientException
         * @throws IOException
         * @throws UnsupportedAudioFileException
         */
        public static boolean requestRegionScores(Server server,
                                                  Scenic.Plugin  plugin,
                                                  Scenic.Domain domain,
                                                  Scenic.Audio audio,
                                                  Server.ResultCallback<Scenic.RegionScorerRequest, Scenic.RegionScorerResult> rc,
                                                  boolean async,
                                                  List<Pair<String, String>> options,
                                                  List<String> classIDs) throws ClientException, IOException, UnsupportedAudioFileException {


            Scenic.RegionScorerRequest.Builder req = Scenic.RegionScorerRequest.newBuilder()
                    .setAudio(audio)
                    .setPlugin(plugin.getId())
                    .setDomain(domain.getId());

            // Add any options, if there are any
            if(null != options) {
                for (Pair<String, String> p : options){
        req.addOption(Scenic.OptionValue.newBuilder().setName(
        p.getFirst()).setValue(p.getSecond()));
                }
            }

            // And add any class IDS  - if any
            if(null != classIDs && classIDs.size() >0)
                req.addAllClassId(classIDs);


            if (async) {
                server.enqueueRequest(req.build(), rc);
            }
            else {

                Server.Result<Scenic.RegionScorerRequest, Scenic.RegionScorerResult> result = server.synchRequest(req.build());
                rc.call(result);
            }

            return true;

        }


### 11.9     preprocessAudioForAdaptation 

This function is used to process all of the audio submitted for adaptation, and prepare it for the adaptation process.  This step performs the bulk of the work for adaptation, and is the most time consuming.  

        public boolean preprocessAudioForAdaptation(Server server,
                                                 Scenic.Plugin  plugin,
                                                 Scenic.Domain domain,
                                                 String classIDName,
                                                 String adaptID,
                                                 Scenic.Audio audio,
                                                    Map<String, List<String>> annotations  ){

            // Prepare the request
            Scenic.PreprocessAudioAdaptRequest.Builder req = Scenic.PreprocessAudioAdaptRequest.newBuilder()
                    .setPlugin(plugin.getId())
                    .setDomain(domain.getId())
                    .setAdaptSpace(adaptID)
                    .setClassId(classIDName)
                    .setAudio(audio);

            Server.Result<Scenic.PreprocessAudioAdaptRequest, Scenic.PreprocessAudioAdaptResult> result = server.synchRequest(req.build());

            if (annotations.containsKey(classIDName)) {
                annotations.get(classIDName).add(result.getRep().getAudioId());
            } else {
                List<String> audioFiles = new ArrayList<>();
                audioFiles.add(result.getRep().getAudioId());
                annotations.put(classIDName, audioFiles);
            }

            return !result.hasError();

        }

### 11.10    finalizeSupervisedAdaptation 

This function takes the metadata and other information extracted from the audio submitted in preprocessAudioForAdaptation and finalizes the adaptation, creating the new, adapted domain.

        public void finalizeSupervisedAdaptation(Server server,
                                                  Scenic.Plugin  plugin,
                                                  Scenic.Domain domain,
                                                  String adaptID,
                                                  String newDomainName,
                                                 Server.ResultCallback<Scenic.SupervisedAdaptationRequest, Scenic.SupervisedAdaptationResult> cb,
                                                 Map<String, List<String>> annotations){

            List<Scenic.ClassAnnotation> classAnnotations = buildAnnotations(annotations);

            // Prepare the request
            Scenic.SupervisedAdaptationRequest.Builder req = Scenic.SupervisedAdaptationRequest.newBuilder()
                    .setPlugin(plugin.getId())
                    .setDomain(domain.getId())
                    .setAdaptSpace(adaptID)
                    .setNewDomain(newDomainName)
                    .addAllClassAnnotations(classAnnotations);


            // Now send the finalize request
            server.enqueueRequest(req.build(), cb);
        }

### 11.11    buildAnnotations

This function is a helper function for finalizing a supervised adaptation request that converts annotations to the proper format required by OLIVE for adaptation.

        public List<Scenic.ClassAnnotation> buildAnnotations(Map<String, List<String>> annotations){

            List<Scenic.ClassAnnotation> classAnnotations = new ArrayList<>();
            for(String id: annotations.keySet()){

                List<Scenic.AudioAnnotation> aaList = new ArrayList<>();
                for(String fileid : annotations.get(id)){

                    // Build  the list of preprocessed audio IDs (there will be no regions)
                    Scenic.AudioAnnotation.Builder aaBuilder = Scenic.AudioAnnotation.newBuilder().setAudioId(fileid);
                    aaList.add(aaBuilder.build());
                }
                Scenic.ClassAnnotation.Builder caBuilder = Scenic.ClassAnnotation.newBuilder().setClassId(id).addAllAnnotations(aaList);
                classAnnotations.add(caBuilder.build());
            }

            return  classAnnotations;
        }


-->
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="workflows.html" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Workflows
              </div>
            </div>
          </a>
        
        
          <a href="olivepyPrimer.html" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                olivepy Primer
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.08c56446.min.js"></script>
      <script src="assets/javascripts/bundle.6ced434e.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      

<script src="assets/javascript/iframe-worker.js"></script>
<script src="search/search_index.js"></script>


      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.8c7e0a7e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="search/search_index.js"></script>
      
        <script src="assets/js/swagger-ui-bundle.js"></script>
      
    
  </body>
</html>